(window["webpackJsonpmy-app"]=window["webpackJsonpmy-app"]||[]).push([[0],{101:function(e,t,a){},102:function(e,t,a){},109:function(e,t,a){},110:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(25),o=a.n(s),i=(a(49),a(2)),c=a(3),u=a(5),d=a(4),l=a(11),m=a(6),p=(a(50),a(7)),f=a.n(p),h=a(8),v=(a(52),a(15)),b=a.n(v),g=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={minimized:!1,maximized:!1,closed:!1},a.onNavBarClick=function(e){var t=e.target.className;"maximize"===t?a.setState({maximized:!a.state.maximized}):"minimize"===t?a.setState({minimized:!a.state.minimized}):"close"===t&&(a.setState({closed:!0}),a.props.ipc("close",[a.props.pid]))},a.renderNavTop=function(){return r.a.createElement("div",{className:"title"},r.a.createElement("button",{className:"close",onClick:a.onNavBarClick},"x"),r.a.createElement("button",{className:"maximize",onClick:a.onNavBarClick},"[]"),r.a.createElement("button",{className:"minimize",onClick:a.onNavBarClick},"_"),r.a.createElement("p",{className:"title"},a.props.title))},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){if(this.state.closed)return null;var e="";e=this.state.minimized?"box box-minimized":this.state.maximized?"box box-full":"box",e=(this.props.className||"")+" "+e;this.props.draggable;return r.a.createElement(b.a,null,r.a.createElement("div",{className:e},this.renderNavTop(),r.a.createElement("div",{className:"body"},this.props.children)))}}]),t}(r.a.Component),y=(a(53),a(54).Parser),k=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).renderHeaders=function(){return a.props.headers?r.a.createElement("thead",null,r.a.createElement("tr",{key:"tbtrh1"},a.props.headers.map(function(e,t){return r.a.createElement("th",{key:"th"+t},e)}))):null},a.renderBody=function(){return a.props.rows?r.a.createElement("tbody",null,a.props.rows.map(function(e,t){var n="";a.props.headers.map(function(t){var a=e[t]||"",r="";if("opts"==t)a.forEach(function(e,t){r+="<a style='color:yellow' href='#' class='onclick_cmd' cmd='".concat(e.cmd,"'>").concat(e.desc,"</a>")}),n+="<td>"+r+"</td>";else if("thumbnail"===t){n+="<td><img width=120 src='"+a+"'></td>"}else n+="<td>"+a+"</td>"});var s=new y;return r.a.createElement("tr",{key:"tr "+t},s.parse(n))})):null},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("table",{className:this.props.className||"table",border:"1"},this.renderHeaders(),this.renderBody())}}]),t}(r.a.Component),w=null,E="localhost"==window.location.hostname?"ws://localhost:8081":"wss://grepawk.com/ws";function O(){var e=localStorage.getItem("uuid");if(e)return e;e=function(){var e=(new Date).getTime();return"undefined"!==typeof performance&&"function"===typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var a=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?a:3&a|8).toString(16)})}(),localStorage.setItem("uuid",e)}var S=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={socket:w,output_rows:[],output_cursor_position:0,uuid:O()},a.initSocket=function(){return new Promise(function(e,t){if(w&&w.readyState===WebSocket.OPEN)e();else{if(w&&w.readyState===WebSocket.CONNECTING)return a.onAddOutputRow({type:"text",data:"Connecting.."}),void e();(w=new WebSocket(E)).onopen=function(t){clearTimeout(n),w.send("check-in "+a.state.uuid),e()};var n=setTimeout(function(){w.readyState,WebSocket.OPEN},5e3)}})},a.onAddOutputRow=function(e){var t=a.state.output_rows.concat(e);a.setState({output_rows:t})},a.parseAPIResponse=function(e){e.stdout&&a.onAddOutputRow({type:"text",data:e.stdout}),e.stderr&&a.onAddOutputRow({type:"text",data:e.stderr}),e.table&&a.onAddOutputRow({type:"table",data:e.table}),e.userInfo&&(localStorage.setItem("uuid",e.userInfo.uuid),a.props.ipc("hud-update",e.userInfo)),e.quests&&a.props.ipc("questlist",e.quests),e.hint},a.renderOutputRow=function(e,t){switch(e.type){case"stdout":case"text":return r.a.createElement("pre",{key:"op-"+t}," ",e.data);case"stderr":return r.a.createElement("pre",{key:"op-"+t}," ",r.a.createElement("span",{style:{color:"red"}},e.data));case"stdin":return r.a.createElement("div",{className:"input-line",key:"op-"+t},r.a.createElement("div",{className:"prompt"},">"),r.a.createElement("input",{className:"cmdline input-line",disabled:!0,value:e.data}));case"table":return r.a.createElement("div",{key:"op-"+t},r.a.createElement(k,{className:"table table-dark",headers:e.data.headers,rows:e.data.rows}))}},a.keyboardLoaded=function(e){e.target.focus()},a.windowLoaded=function(e){document.getElementsByClassName("terminal-body").scrollTo(0,100),e.target.offsetHeight=1e3},a.keyboardPressed=function(e){13==e.keyCode&&(a.onAddOutputRow({type:"stdin",data:e.target.value}),a.locallyProcessed(e.target.value)||w.send(e.target.value),e.target.value="")},a.renderInputBar=function(){return r.a.createElement("div",{className:"input-line"},r.a.createElement("div",{id:"stdin-prompt",className:"prompt"}," > "),r.a.createElement("input",{autofocus:"true",onLoad:a.keyboardLoaded,onKeyDown:a.keyboardPressed,size:"80",id:"terminal_input",autoComplete:"off",className:"cmdline input-line"}))},a.clickOnTerminal=function(e){document.getElementById("terminal_input").focus()},a.scrollToBottom=function(){a.messagesEnd.scrollIntoView({behavior:"smooth"})},a.prompt=r.a.createRef(),a.promptInput=r.a.createRef(),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=Object(h.a)(f.a.mark(function e(){var t=this;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initSocket();case 2:w.onmessage=function(e){if("object"===typeof e.data){var a=new Image;a.src=URL.createObjectURL(e.data),t.onAddOutputRow({type:"image",data:a})}else if(e.data&&e.data.startsWith("stdout: ")){var n=e.data.replace("stdout: ","");t.onAddOutputRow({type:"text",data:n})}else if(e.data&&e.data.startsWith("stderr: ")){n=e.data.replace("stderr: ","");t.onAddOutputRow({type:"text",data:n})}else t.parseAPIResponse(JSON.parse(e.data))};case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"locallyProcessed",value:function(e){if(!e)return!1;var t=e.split(" "),a=t[0],n=t.splice(1);switch(a){case"cam":case"upload":case"new":case"stream":case"broadcast":case"draw":case"watch":return this.props.ipc(a,n),!0;default:return!1}}},{key:"render",value:function(){var e=this;return r.a.createElement(g,{className:"terminal",title:this.props.title,pid:this.props.pid,ipc:this.props.ipc},r.a.createElement("div",{className:"terminal-body",onClick:this.clickOnTerminal,onLoad:function(){}},this.state.output_rows.map(function(t,a){return e.renderOutputRow(t,a)}),this.renderInputBar(),r.a.createElement("div",{className:"terminal-anchor",ref:function(t){e.messagesEnd=t}}," ")))}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}}]),t}(r.a.Component),C={float:"right",marginRight:"15px"},x=function(e){function t(e){return Object(i.a)(this,t),Object(u.a)(this,Object(d.a)(t).call(this,e))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("span",{style:C,className:"HUD"},"Name: ",this.props.fname||this.props.username||"guest",", Location: ",this.props.cwd||"root",", XP Level:",this.props.xp||0,", Gold:",this.props.points||0)}}]),t}(r.a.Component),j=function(e){function t(){return Object(i.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:this.props.className},r.a.createElement("h5",null,this.props.title),r.a.createElement("ul",null,this.props.list&&this.props.list.map?this.props.list.map(function(e,t){return r.a.createElement("li",{key:"list-"+t},r.a.createElement("h5",{className:"list-header"},e.title),r.a.createElement("div",{className:"list-body"},e.description))}):null))}}]),t}(r.a.Component),N=function(e){function t(){return Object(i.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.video.srcObject=this.props.media}},{key:"shouldComponentUpdate",value:function(e){return this.props.media!==e.media}},{key:"componentDidUpdate",value:function(){this.video.srcObject=this.props.media}},{key:"render",value:function(){var e=this,t=this.props,a=t.width,n=t.height,s=t.muted,o=t.children;return r.a.createElement("video",{height:n,width:a,muted:s,autoPlay:!0,playsInLine:!0,ref:function(t){e.video=t}},o)}}]),t}(r.a.Component);N.defaultProps={children:null,height:420,width:640,muted:!0,media:null};var R,_,I=N,B={RTCIceServers:[{url:"stun:stun.l.google.com:19302"},{url:"turn:192.158.29.39:3478?transport=udp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"},{url:"turn:192.158.29.39:3478?transport=tcp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"}],optional:[{DtlsSrtpKeyAgreement:!0}]},T=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={enteredRoom:!1,signalConnected:!1,videoOn:!0,audioOn:!0,flashMessage:"",error:null,myStream:null,room:a.props.room||"default",isHost:null,remoteStreams:[]},a.joinRoom=Object(h.a)(f.a.mark(function e(){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({enteredRoom:!0}),R.send(JSON.stringify({type:"login",channel:a.state.room,uuid:a.props.userInfo.uuid}));case 2:case"end":return e.stop()}},e)})),a.initiateRTCPeerConnection=function(){return(_=new RTCPeerConnection(B)).ontrack=function(e){if(e.streams&&e.streams[0]){var t=a.state.remoteStreams.concat(e.streams[0]);a.setState({remoteStreams:t})}},_.onicecandidateerror=function(e){a.setState({flashMessage:e.message})},_.onicecandidate=function(e){null!=e.candidate&&R.send(JSON.stringify({type:"candidate",candidate:e.candidate,channel:a.state.room}))},_},a.onLoggedInWithSignalServer=function(e){a.setState({signalConnected:!0}),1!=e.usersCount?(a.initiateRTCPeerConnection(),_.onnegotiationneeded=function(e){_.createOffer().then(function(e){_.setLocalDescription(e),R.send(JSON.stringify({type:"offer",offer:e,channel:a.state.room}))}).catch(function(e){alert(e.message)})},a.state.myStream.getTracks(function(e){_.addTrack(e,a.state.myStream)}),_.createOffer().then(function(e){_.setLocalDescription(e),R.send(JSON.stringify({type:"offer",offer:e,channel:a.state.room}))}).catch(function(e){alert(e.message)})):a.setState({flashMessage:"Joined channel "+e.channelJoined+". Only you here."})},a.onReceivedRemoteConnectionOffer=function(e){a.initiateRTCPeerConnection(),_.setRemoteDescription(new RTCSessionDescription(e.offer)).then(function(){a.state.myStream.getTracks().forEach(function(e){_.addTrack(e,a.state.myStream)})}).then(function(){return _.createAnswer()}).then(function(e){return _.setLocalDescription(e),e}).then(function(t){R.send(JSON.stringify({type:"answer",answer:t,channel:e.channel,uuid:e.caller_id}))}).catch(function(e){console.log(e),a.setState({flashMessage:e.message+" on receive remote errored"})})},a.onReceivedConnectionRequestResponse=function(e){e.answer.sdp&&_.setRemoteDescription(e.answer).then(function(){return navigator.mediaDevices.getDisplayMedia()}).then(function(e){e.getTracks().forEach(function(t){return _.addTrack(t,e)})})},a.onReceivedICECandidate=function(e){_.addIceCandidate(e.candidate).catch(function(e){console.log("Failure during addIceCandidate(): "+e.name)})},a.chatRoomChanged=function(e){var t=e.target.value;a.setState({room:t})},a.audioCheckBoxChanged=function(e){a.setState({audioOn:e.target.value})},a.videoCheckBoxChanged=function(e){a.setState({videoOn:e.target.value})},a.gotMyStream=function(e){a.setState({myStream:e})},a.renderLobby=function(){return r.a.createElement("div",{className:"cam-lobby"},r.a.createElement("p",null,a.state.flashMessage),r.a.createElement(I,{width:300,media:a.state.myStream}),r.a.createElement("p",null,"Join Room: ",r.a.createElement("input",{id:"join_room_name",onChange:a.chatRoomChanged,value:a.state.room,type:"text",size:"50"})),r.a.createElement("p",null,"Audio: ",r.a.createElement("input",{id:"join_room_audio",onChange:a.audioCheckBoxChanged,type:"checkbox",checked:!0})),r.a.createElement("p",null,"Video: ",r.a.createElement("input",{id:"join_room_video",onChange:a.videoCheckBoxChanged,type:"checkbox",checked:!0})),r.a.createElement("p",null,r.a.createElement("button",{onClick:a.joinRoom},"Go")," "))},a.renderRoom=function(){return r.a.createElement("div",{className:"cam-room"},r.a.createElement("h3",null,"Room ",a.state.room),r.a.createElement("p",null,a.state.flashMessage),r.a.createElement(I,{key:"mstream",width:200,height:100,media:a.state.myStream}),a.state.remoteStreams.map(function(e,t){return console.log(e),r.a.createElement(I,{key:"remote-stream-"+t,width:100,height:100,media:e})}))},a.onClosed=function(){},a.videoRef=r.a.createRef(),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=Object(h.a)(f.a.mark(function e(){var t,a=this;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(R=new WebSocket("ws://localhost:9090")).onopen=function(e){a.setState({signalConnected:!0})},R.onmessage=function(e){try{var t=JSON.parse(e.data);console.log("signal on msg ",e),"login"===t.type?a.onLoggedInWithSignalServer(t):"offer"===t.type?t.offer.sdp?a.onReceivedRemoteConnectionOffer(t):console.log("signal ret offer not contrain sdp",t):"answer"===t.type?a.onReceivedConnectionRequestResponse(t):"candidate"===t.type?a.onReceivedICECandidate(t):"error"===t.type&&a.setState({flashMessage:t.message})}catch(n){console.log("signal onmsg failed",n)}},e.prev=3,e.next=6,navigator.mediaDevices.getDisplayMedia();case 6:t=e.sent,this.setState({myStream:t}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),this.setState({error:e.t0.message});case 13:case"end":return e.stop()}},e,this,[[3,10]])}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.onClosed()}},{key:"render",value:function(){return r.a.createElement(g,{className:"camera",title:this.props.title,pid:this.props.pid,ipc:this.props.ipc},null!==this.state.error?r.a.createElement("div",null,"Error: ",this.state.error):0==this.state.signalConnected||null==this.state.myStream?r.a.createElement("div",null,"Connecting.."):0==this.state.enteredRoom?this.renderLobby():this.renderRoom())}}]),t}(r.a.Component),D=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(s)))).renderVideo=function(e,t,a){return r.a.createElement(I,{width:"100%",height:"100%",media:e})},a.renderAudio=function(){return r.a.createElement("div",null,"todo")},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.mediaObject[0],t=this.props.mediaObject[1],a=this.props.mediaObject[2],n={position:"absolute",left:a[0]+"%",top:a[1]+"%",width:a[2]+"%",height:a[3]+"%"};return this.props.notDraggable?r.a.createElement("div",{style:n},"video"==e?this.renderVideo(t):null,"screenshare"==e?this.renderVideo(t):null,"webcam"==e?this.renderVideo(t):null,"audio"==e?this.renderAudio(t):null):r.a.createElement(b.a,null,r.a.createElement("div",{style:n},"video"==e?this.renderVideo(t):null,"screenshare"==e?this.renderVideo(t):null,"webcam"==e?this.renderVideo(t):null,"audio"==e?this.renderAudio(t):null))}}]),t}(r.a.Component),M=(a(101),{RTCIceServers:[{url:"stun:stun.l.google.com:19302"}]}),A="localhost"==window.location.hostname?"ws://localhost:9091":"wss://grepawk.com/signal";var J=function(e){(e=e||{}).console=e.console||"console";var t,a,n=e.hostname||A,r=e.onEvent||console.log,s={},o=[];function i(e,t,a){return{id:e,track:t,dimensions:a,live:!0}}function c(){Object.values(s).forEach(function(e){e.updateTracks(o)})}return{requestUserStream:function(e){return new Promise(function(){var t=Object(h.a)(f.a.mark(function t(a,n){var r;return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,"screenshare"!=e){t.next=7;break}return t.next=4,navigator.mediaDevices.getDisplayMedia();case 4:r=t.sent,t.next=20;break;case 7:if("webcam"!=e){t.next=13;break}return t.next=10,navigator.mediaDevices.getUserMedia({video:!0,audio:!1});case 10:r=t.sent,t.next=20;break;case 13:if("audio"!=e){t.next=19;break}return t.next=16,navigator.mediaDevices.getUserMedia({video:!1,audio:!0});case 16:r=t.sent,t.next=20;break;case 19:n(new Error("Unkown type"));case 20:a(r||null),t.next=26;break;case 23:t.prev=23,t.t0=t.catch(0),n(t.t0);case 26:case"end":return t.stop()}},t,null,[[0,23]])}));return function(e,a){return t.apply(this,arguments)}}())},addStream:function(e,t){e.getTracks().forEach(function(e){!function(e,t){for(var a in o)o[a].id===e.id&&(o[a]=i(e.id,e,t));o.push(i(e.id,e,t))}(e,t)}),c()},removeStream:function(e){return e.getTracks().forEach(function(e){!function(e){for(var t in o)o[t].id===e.id&&(o[t].live=!1)}(e),e.stop()}),c(),null},peerConnections:s,startBroadcast:function(e){(t=new WebSocket(n)).onmessage=function(e){var n=JSON.parse(e.data);switch(r(e.data.type||""),n.type){case"registered":a=n.host_uuid;break;case"user_joined":!function(e){if(!e.client_uuid)throw new Error("unexpected user_join request");s[e.client_uuid]=function(e,t,a,n){e=e,t=t;var r=new RTCPeerConnection(M),s=r.createDataChannel("metadata"),o={};function i(){if(!s||"open"!==s.readyState)return n("metadata channel not yet o0pen"),void setTimeout(i,1e3);var e=[];Object.keys(o).forEach(function(t){var a=o[t];e.push({trackId:a.id,dimensions:a.dimensions,live:a.active})});var t={type:"mediaMetadata",data:e};n("sending metadata ",t),s.send(JSON.stringify(t))}return s.onopen=function(){n("Meta channel open with "+t),i()},r.onicecandidate=function(n){n.candidate&&e.send(JSON.stringify({type:"candidate",candidate:n.candidate,to_uuid:t,host_uuid:a}))},r.onnegotiationneeded=function(){var s=Object(h.a)(f.a.mark(function s(o){var i;return f.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return n("creating sdp offer for "+t),s.next=3,r.createOffer();case 3:return i=s.sent,s.next=6,r.setLocalDescription(i);case 6:e.send(JSON.stringify({type:"offer",to_uuid:t,offer:i,host_uuid:a}));case 7:case"end":return s.stop()}},s)}));return function(e){return s.apply(this,arguments)}}(),{updateTracks:function(e){for(var t in e){var a=e[t].id;"undefined"===typeof o[a]&&(o[a]=e[t],e[t].live&&r.addTrack(e[t].track))}i()},set_sdp_anwser:function(){var e=Object(h.a)(f.a.mark(function e(t){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.setRemoteDescription(t);case 3:n("Remote Anwser set"),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),n("ERROR: in set_dsp_anwser");case 9:case"end":return e.stop()}},e,null,[[0,6]])}));return function(t){return e.apply(this,arguments)}}(),addIceCandidate:function(e){n("add ice candidate "),r.addIceCandidate(e)}}}(t,e.client_uuid,a,r),s[e.client_uuid].updateTracks(o)}(n);break;case"answer":!function(e){if(!e.client_uuid||!e.answer)throw new Error("unexpected request in user_sent_peer_ice_candidate");s[e.client_uuid].set_sdp_anwser(e.answer)}(n);break;case"candidate":!function(e){if(!e.client_uuid||!e.candidate)throw new Error("unexpected request in user_sent_peer_ice_candidate");s[e.client_uuid].addIceCandidate(e.candidate),r("add peer ice candidate from "+e.client_uuid)}(n)}},t.onopen=function(a){var n,s;n={type:"register_stream",channel:e},s&&(n[s]=s),t.send(JSON.stringify(n)),r("Stream registered "+e)},t.onerror=function(e){return r("ERROR: signalconnection not connecting",e)}}}},P={screenshare:[0,0,100,100],webcam:[0,80,20,20],audio:[90,0,10,10],textBanner:[5,5,80,10]},L=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={screenshare:!1,webcam:!1,audio:!1,streamElements:{},broadcasting:!1,broadcastEvents:[]},a.onBroadcastEvent=function(e){var t=a.state.broadcastEvents;t.push(e),a.setState({broadcastEvents:t})},a.updateStreamElements=function(e,t,n){var r=a.state.streamElements;r[e]=[e,t,n],null!==t&&!0===a.state.broadcasting&&(a.broadcastClient.addStream(t,n),a.onBroadcastEvent("Adding stream "+e)),a.setState({streamElements:r})},a.renderObjectives=function(){},a.renderPreview=function(){var e=Object.keys(a.state.streamElements);return r.a.createElement("div",null,e.map(function(e){return r.a.createElement(D,{mediaObject:a.state.streamElements[e]})}))},a.controlClicked=function(){var e=Object(h.a)(f.a.mark(function e(t){var n,r,s;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=!a.state[t],r=a.state.streamElements[t]&&a.state.streamElements[t][1]||null,e.t0=t,e.next="screenshare"===e.t0?5:"webcam"===e.t0?18:"audio"===e.t0?31:44;break;case 5:if(!n){e.next=11;break}return e.next=8,a.broadcastClient.requestUserStream(t);case 8:e.t1=e.sent,e.next=14;break;case 11:return e.next=13,a.broadcastClient.removeStream(r);case 13:e.t1=e.sent;case 14:return s=e.t1,a.updateStreamElements(t,s,P[t]),a.setState({screenshare:n}),e.abrupt("break",45);case 18:if(!n){e.next=24;break}return e.next=21,a.broadcastClient.requestUserStream(t);case 21:e.t2=e.sent,e.next=27;break;case 24:return e.next=26,a.broadcastClient.removeStream(r);case 26:e.t2=e.sent;case 27:return s=e.t2,a.updateStreamElements(t,s,P[t]),a.setState({webcam:n}),e.abrupt("break",45);case 31:if(!n){e.next=37;break}return e.next=34,a.broadcastClient.requestUserStream(t);case 34:e.t3=e.sent,e.next=40;break;case 37:return e.next=39,a.broadcastClient.removeStream(r);case 39:e.t3=e.sent;case 40:return s=e.t3,a.updateStreamElements(t,s,P[t]),a.setState({audio:n}),e.abrupt("break",45);case 44:return e.abrupt("break",45);case 45:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.renderConsole=function(){return r.a.createElement("div",null,a.state.broadcastEvents.map(function(e){var t;return t="object"===typeof e?JSON.stringify(e):e,r.a.createElement("p",null,t)}))},a.startBroadcasting=Object(h.a)(f.a.mark(function e(){var t;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.channelName,a.channelName||(a.channelName=prompt("What channel name do you want?")),a.channelName){e.next=4;break}return e.abrupt("return");case 4:window.confirm("Start broadcasting at https://grepawk.com/c/"+t+" now?")&&(a.broadcastClient.startBroadcast(t),Object.values(a.state.streamElements).forEach(function(e){null!==e[1]&&a.broadcastClient.addStream(e[1],e[2])}),a.setState({broadcasting:!0}));case 6:case"end":return e.stop()}},e)})),a.stopBroadcasting=function(){a.setState({broadcasting:!1})},a.renderControls=function(){return r.a.createElement("ul",{className:"list-group controls"},["screenshare","webcam","audio"].map(function(e){var t=a.state[e],n=t?e+" off":e,s=t?"btn btn-secondary":"btn btn-primary";return r.a.createElement("li",{className:"list-group-item"},r.a.createElement("button",{className:s,onClick:function(){a.controlClicked(e)}},n))}))},a.renderHeader=function(){return r.a.createElement("div",{className:"header"},!1===a.state.broadcasting?r.a.createElement("a",{href:"javascript://",onClick:a.startBroadcasting},"Start Broadcast  "):r.a.createElement("a",{href:"javascript://",onClick:a.stopBroadcasting},"Stop Broadcast"))},a.broadcastClient=J({onEvent:a.onBroadcastEvent,console:"console"}),a.channelName=a.props.args[0],a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return r.a.createElement(g,{className:"stream",title:this.props.title,pid:this.props.pid,ipc:this.props.ipc,draggable:!1},this.state.flashMessage?r.a.createElement("div",null,this.state.flashMessage):null,r.a.createElement("div",{className:"obs"},this.renderHeader(),this.renderControls(),r.a.createElement("div",{className:"preview",ref:this.previewDiv},this.renderPreview()),r.a.createElement("div",{className:"console"},this.renderConsole()),r.a.createElement("div",{className:"objectives"},this.renderObjectives())))}}]),t}(r.a.Component),W="localhost"==window.location.hostname?"ws://localhost:9091":"wss://grepawk.com/signal",q={RTCIceServers:[{url:"stun:stun.l.google.com:19302"}]};var z=function(e){var t,a,n,r=e.hostname||W,s=e.onEvent||console.log,o=e.mediaObjectReady,i=(e.mediaObjectOffline,{}),c={};function u(){return(u=Object(h.a)(f.a.mark(function e(r,u){var d,l;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return d=function(){for(var e in s("showing remote tracks: "+Object.keys(c).length),c){var t=c[e];if(i[e]){var a=new MediaStream;a.addTrack(i[e]),o(e,a,i[e].kind,t.dimensions),s("showing tracking ")}else s("Got meta data but not track")}},n=u,(a=new RTCPeerConnection(q)).ondatachannel=function(e){e.channel.onopen=function(){return s("metadata channel on client open")},e.channel.onmessage=function(e){s("got metadata "+e.data);var t=JSON.parse(e.data);"mediaMetadata"==t.type&&t.data.forEach(function(e){var t=e.trackId;c[t]=e});d()}},a.onicecandidate=function(e){s("client on ice candidate ",e),e.candidate&&t.send(JSON.stringify({type:"candidate",to_uuid:n,candidate:e.candidate}))},a.ontrack=function(e){e.track&&(i[e.track.id]=e.track),d()},e.next=8,a.setRemoteDescription(new RTCSessionDescription(r));case 8:return e.next=10,a.createAnswer();case 10:l=e.sent,a.setLocalDescription(l),t.send(JSON.stringify({type:"answer",to_uuid:n,answer:l}));case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}return{watchChannel:function(e){(t=new WebSocket(r)).onopen=function(n){t.send(JSON.stringify({type:"watch_stream",channel:e})),t.onmessage=function(e){var t=JSON.parse(e.data);switch(s("Signal Server msg type "+t.type),t.type){case"offer":s("got offer: host_uuid=",t.host_uuid),function(e,t){u.apply(this,arguments)}(t.offer,t.host_uuid);break;case"candidate":s("got candidate"),a.addIceCandidate(t.candidate);break;case"error":s("Error: "+t.message)}}}}}},V=(a(102),function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={broadcastEvents:[],media:{}},a.mediaObjectReady=function(e,t,n,r){var s=a.state.media;s[e]=[n,t,r],a.setState({media:s})},a.mediaObjectOffline=function(e){var t=a.state.media;delete t[e],a.setState({media:t})},a.onBroadcastEvent=function(e){var t=a.state.broadcastEvents;t.push(e),a.setState({broadcastEvents:t})},a.renderStream=function(){var e=Object.keys(a.state.media);return console.log("Rendering "+e.length+" stream parts"),r.a.createElement("div",{className:"stream-content"},e.map(function(e,t){return r.a.createElement(D,{key:t,notDraggable:!0,mediaObject:a.state.media[e]})}))},a.renderConsole=function(){return r.a.createElement("div",{className:"console-watcher"},a.state.broadcastEvents.map(function(e,t){var a;return a="object"===typeof e?JSON.stringify(e):e,r.a.createElement("p",{key:t},a)}))},a.broadcastViewerClient=z({channelName:a.props.channelName,onEvent:a.onBroadcastEvent,mediaObjectReady:a.mediaObjectReady,mediaObjectOffline:a.mediaObjectReady}),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.broadcastViewerClient.watchChannel(this.props.channelName)}},{key:"render",value:function(){return r.a.createElement(g,{className:"watch-stream",title:this.props.title,pid:this.props.pid,ipc:this.props.ipc,draggable:!1},r.a.createElement("div",{key:"rr",className:"stream-wrapper"},this.renderStream(),this.renderConsole()))}}]),t}(r.a.Component)),U=(a(103),a(109),function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).iconClicked=a.iconClicked.bind(Object(l.a)(a)),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"iconClicked",value:function(e){var t=this.props.icons[e];this.props.ipc(t.cmd,t.args)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"app-icon-grid"},this.props.icons.map(function(t,a){var n=(a+1)%5,s=Math.floor((a+1)/5),o={gridColumnStart:s,gridColumnEnd:s+1,gridRowStart:n,gridRowEnd:n+1,width:50,height:50,borderColor:"black",borderWidth:2};return r.a.createElement("div",{key:"icon"+a,style:o,onClick:function(){e.iconClicked(a)}},r.a.createElement("i",{className:"fas fa-lg fa-"+t.name}),r.a.createElement("br",null),t.title)}))}}]),t}(r.a.Component)),H=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={processes:[{name:"tty",state:"on"}],userInfo:{name:"guest",xp:0,gold:0},quests:[],icons:[{name:"terminal",title:"terminal",cmd:"tty",args:[]},{name:"broadcast-tower",title:"Broadcast",cmd:"stream",args:[]},{name:"play-circle",title:"Watch Hearthstone",cmd:"watch",args:["rank_5_rogue"]},{name:"play-circle",title:"Watch WoW",cmd:"watch",args:["asmongold"]}]},a.ipc=a.ipc.bind(Object(l.a)(a)),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){if(window.location.search){var e=window.location.search.replace("?","").split("/"),t=e[0],a=e.splice(1);this.ipc(t,a)}}},{key:"ipc",value:function(e,t){switch(e){case"close":var a=t[0],n=this.state.processes;n[a]="closed",this.setState({processes:n});break;case"cam":case"camera":var r=this.state.processes.concat({name:"camera"});this.setState({processes:r});break;case"broadcast":case"stream":r=this.state.processes.concat({name:"stream",args:t});this.setState({processes:r});break;case"watch":r=this.state.processes.concat({name:"watch",args:t});this.setState({processes:r});break;case"tty":r=this.state.processes.concat({name:"tty",args:t});this.setState({processes:r});break;case"hud-update":this.setState({userInfo:t});break;case"questlist":this.setState({quests:t})}}},{key:"renderBody",value:function(){var e=this;return this.state.processes.map(function(t,a){if(console.log(t,a),"off"===t.state)return null;if("tty"===t.name)return r.a.createElement(S,{key:"tty1",pid:a,title:"tty",ipc:e.ipc});if("camera"===t.name)return r.a.createElement(T,{userInfo:e.state.userInfo,pid:a,title:"Face 2 Face",ipc:e.ipc});if("stream"===t.name)return r.a.createElement(L,{args:t.args,channel:t.args[0]||"",pid:a,title:"Broadcast",ipc:e.ipc});if("watch"===t.name){var n=t.args[0]||"default";return r.a.createElement(V,{userInfo:e.state.userInfo,channelName:n,pid:a,title:"Watch",ipc:e.ipc})}})}},{key:"renderHud",value:function(){return this.state.userInfo?r.a.createElement(x,{username:this.state.userInfo.username,cwd:this.state.userInfo.cwd,fname:this.state.userInfo.fname,xp:this.state.userInfo.xp,gold:this.state.userInfo.gold}):null}},{key:"renderQuestView",value:function(){return r.a.createElement(j,{className:"quest-list",title:"quests",list:this.state.quests})}},{key:"renderBackground",value:function(){return r.a.createElement(U,{icons:this.state.icons,ipc:this.ipc})}},{key:"render",value:function(){return r.a.createElement("div",{className:"desktop"},r.a.createElement("nav",{className:"navbar navbar-light bg-light"},r.a.createElement("a",{className:"navbar-brand",href:"#"},"GrepAwk"),this.renderHud()),this.renderBackground(),this.renderBody(),this.renderQuestView())}}]),t}(r.a.Component);o.a.render(r.a.createElement(H,null),document.getElementById("root"))},44:function(e,t,a){e.exports=a(110)},49:function(e,t,a){},50:function(e,t,a){},52:function(e,t,a){},53:function(e,t,a){},92:function(e,t){}},[[44,1,2]]]);
//# sourceMappingURL=main.2f787bee.chunk.js.map