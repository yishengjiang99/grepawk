(window["webpackJsonpmy-app"]=window["webpackJsonpmy-app"]||[]).push([[0],{101:function(e,t,n){},108:function(e,t,n){},109:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(25),o=n.n(s),c=(n(49),n(3)),i=n(4),u=n(6),l=n(5),d=n(11),m=n(7),p=(n(50),n(1)),f=n.n(p),h=n(8),v=(n(52),n(15)),b=n.n(v),g=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={minimized:!1,maximized:!1,closed:!1},n.onNavBarClick=function(e){var t=e.target.className;"maximize"===t?n.setState({maximized:!n.state.maximized}):"minimize"===t?n.setState({minimized:!n.state.minimized}):"close"===t&&(n.setState({closed:!0}),n.props.ipc("close",[n.props.pid]))},n.renderNavTop=function(){return r.a.createElement("div",{className:"title"},r.a.createElement("button",{className:"close",onClick:n.onNavBarClick},"x"),r.a.createElement("button",{className:"maximize",onClick:n.onNavBarClick},"[]"),r.a.createElement("button",{className:"minimize",onClick:n.onNavBarClick},"_"),r.a.createElement("p",{className:"title"},n.props.title))},n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){if(this.state.closed)return null;var e="";return e=this.state.minimized?"box box-minimized":this.state.maximized?"box box-full":"box",e=(this.props.className||"")+" "+e,!1===(this.props.draggable&&!0)?r.a.createElement("div",{className:e},this.renderNavTop(),r.a.createElement("div",{className:"body"},this.props.children)):r.a.createElement(b.a,null,r.a.createElement("div",{className:e},this.renderNavTop(),r.a.createElement("div",{className:"body"},this.props.children)))}}]),t}(r.a.Component),y=(n(53),n(54).Parser),w=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).renderHeaders=function(){return n.props.headers?r.a.createElement("thead",null,r.a.createElement("tr",{key:"tbtrh1"},n.props.headers.map(function(e,t){return r.a.createElement("th",{key:"th"+t},e)}))):null},n.renderBody=function(){return n.props.rows?r.a.createElement("tbody",null,n.props.rows.map(function(e,t){var a="";n.props.headers.map(function(t){var n=e[t]||"",r="";if("opts"==t)n.forEach(function(e,t){r+="<a style='color:yellow' href='#' class='onclick_cmd' cmd='".concat(e.cmd,"'>").concat(e.desc,"</a>")}),a+="<td>"+r+"</td>";else if("thumbnail"===t){a+="<td><img width=120 src='"+n+"'></td>"}else a+="<td>"+n+"</td>"});var s=new y;return r.a.createElement("tr",{key:"tr "+t},s.parse(a))})):null},n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return r.a.createElement("table",{className:this.props.className||"table",border:"1"},this.renderHeaders(),this.renderBody())}}]),t}(r.a.Component),k=null,E="localhost"==window.location.hostname?"ws://localhost:8081":"wss://grepawk.com/node";function O(){var e=localStorage.getItem("uuid");if(e)return e;e=function(){var e=(new Date).getTime();return"undefined"!==typeof performance&&"function"===typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)})}(),localStorage.setItem("uuid",e)}var x=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={socket:k,output_rows:[],output_cursor_position:0,uuid:O()},n.initSocket=function(){return new Promise(function(e,t){if(k&&k.readyState===WebSocket.OPEN)e();else{if(k&&k.readyState===WebSocket.CONNECTING)return n.onAddOutputRow({type:"text",data:"Connecting.."}),void e();(k=new WebSocket(E)).onopen=function(t){clearTimeout(a),k.send("check-in "+n.state.uuid),e()};var a=setTimeout(function(){k.readyState,WebSocket.OPEN},5e3)}})},n.onAddOutputRow=function(e){var t=n.state.output_rows.concat(e);n.setState({output_rows:t})},n.parseAPIResponse=function(e){e.stdout&&n.onAddOutputRow({type:"text",data:e.stdout}),e.stderr&&n.onAddOutputRow({type:"text",data:e.stderr}),e.table&&n.onAddOutputRow({type:"table",data:e.table}),e.userInfo&&(localStorage.setItem("uuid",e.userInfo.uuid),n.props.ipc("hud-update",e.userInfo)),e.quests&&n.props.ipc("questlist",e.quests),e.hint},n.renderOutputRow=function(e,t){switch(e.type){case"stdout":case"text":return r.a.createElement("pre",{key:"op-"+t}," ",e.data);case"stderr":return r.a.createElement("pre",{key:"op-"+t}," ",r.a.createElement("span",{style:{color:"red"}},e.data));case"stdin":return r.a.createElement("div",{className:"input-line",key:"op-"+t},r.a.createElement("div",{className:"prompt"},"$"),r.a.createElement("input",{className:"cmdline input-line",disabled:!0,value:e.data}));case"table":return r.a.createElement("div",{key:"op-"+t},r.a.createElement(w,{className:"table table-dark",headers:e.data.headers,rows:e.data.rows}))}},n.keyboardLoaded=function(e){e.target.focus()},n.windowLoaded=function(e){document.getElementsByClassName("terminal-body").scrollTo(0,100),e.target.offsetHeight=1e3},n.keyboardPressed=function(e){13==e.keyCode&&(n.onAddOutputRow({type:"stdin",data:e.target.value}),n.locallyProcessed(e.target.value)||k.send(e.target.value),e.target.value="")},n.renderInputBar=function(){return r.a.createElement("div",{className:"input-line"},r.a.createElement("div",{className:"prompt"},"$"),r.a.createElement("input",{onLoad:n.keyboardLoaded,onKeyDown:n.keyboardPressed,size:"80",id:"terminal_input",autoComplete:"off",className:"cmdline input-line"}))},n.clickOnTerminal=function(e){document.getElementById("terminal_input").focus()},n.scrollToBottom=function(){n.messagesEnd.scrollIntoView({behavior:"smooth"})},n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=Object(h.a)(f.a.mark(function e(){var t=this;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initSocket();case 2:k.onmessage=function(e){if("object"===typeof e.data){var n=new Image;n.src=URL.createObjectURL(e.data),t.onAddOutputRow({type:"image",data:n})}else if(e.data&&e.data.startsWith("stdout: ")){var a=e.data.replace("stdout: ","");t.onAddOutputRow({type:"text",data:a})}else if(e.data&&e.data.startsWith("stderr: ")){a=e.data.replace("stderr: ","");t.onAddOutputRow({type:"text",data:a})}else t.parseAPIResponse(JSON.parse(e.data))},window.terminalDidMount();case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"locallyProcessed",value:function(e){if(!e)return!1;var t=e.split(" "),n=t[0],a=t.splice(1);switch(n){case"cam":case"upload":case"new":case"stream":case"broadcast":case"draw":case"watch":return this.props.ipc(n,a),!0;default:return!1}}},{key:"render",value:function(){var e=this;return r.a.createElement(g,{className:"terminal",title:this.props.title,pid:this.props.pid,ipc:this.props.ipc},r.a.createElement("div",{className:"terminal-body",onClick:this.clickOnTerminal},this.state.output_rows.map(function(t,n){return e.renderOutputRow(t,n)}),this.renderInputBar(),r.a.createElement("div",{className:"terminal-anchor",ref:function(t){e.messagesEnd=t}}," ")))}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}}]),t}(r.a.Component),S={float:"right",marginRight:"15px"},C=function(e){function t(e){return Object(c.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return r.a.createElement("span",{style:S,className:"HUD"},"Name: ",this.props.fname||this.props.username||"guest",", Location: ",this.props.cwd||"root",", XP Level:",this.props.xp||0,", Gold:",this.props.points||0)}}]),t}(r.a.Component),j=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:this.props.className},r.a.createElement("h5",null,this.props.title),r.a.createElement("ul",null,this.props.list&&this.props.list.map?this.props.list.map(function(e,t){return r.a.createElement("li",{key:"list-"+t},r.a.createElement("h5",{className:"list-header"},e.title),r.a.createElement("div",{className:"list-body"},e.description))}):null))}}]),t}(r.a.Component),N=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.video.srcObject=this.props.media}},{key:"shouldComponentUpdate",value:function(e){return this.props.media!==e.media}},{key:"componentDidUpdate",value:function(){this.video.srcObject=this.props.media}},{key:"render",value:function(){var e=this,t=this.props,n=t.width,a=t.height,s=t.muted,o=t.children;return r.a.createElement("video",{height:a,width:n,muted:s,autoPlay:!0,ref:function(t){e.video=t}},o)}}]),t}(r.a.Component);N.defaultProps={children:null,height:420,width:640,muted:!0,media:null};var R,_,I=N,T={RTCIceServers:[{url:"stun:stun.l.google.com:19302"},{url:"turn:192.158.29.39:3478?transport=udp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"},{url:"turn:192.158.29.39:3478?transport=tcp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"}],optional:[{DtlsSrtpKeyAgreement:!0}]},D=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={enteredRoom:!1,signalConnected:!1,videoOn:!0,audioOn:!0,flashMessage:"",error:null,myStream:null,room:n.props.room||"default",isHost:null,remoteStreams:[]},n.joinRoom=Object(h.a)(f.a.mark(function e(){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n.setState({enteredRoom:!0}),R.send(JSON.stringify({type:"login",channel:n.state.room,uuid:n.props.userInfo.uuid}));case 2:case"end":return e.stop()}},e)})),n.initiateRTCPeerConnection=function(){return(_=new RTCPeerConnection(T)).ontrack=function(e){if(e.streams&&e.streams[0]){var t=n.state.remoteStreams.concat(e.streams[0]);n.setState({remoteStreams:t})}},_.onicecandidateerror=function(e){n.setState({flashMessage:e.message})},_.onicecandidate=function(e){null!=e.candidate&&R.send(JSON.stringify({type:"candidate",candidate:e.candidate,channel:n.state.room}))},_},n.onLoggedInWithSignalServer=function(e){n.setState({signalConnected:!0}),1!=e.usersCount?(n.initiateRTCPeerConnection(),_.onnegotiationneeded=function(e){_.createOffer().then(function(e){_.setLocalDescription(e),R.send(JSON.stringify({type:"offer",offer:e,channel:n.state.room}))}).catch(function(e){alert(e.message)})},n.state.myStream.getTracks(function(e){_.addTrack(e,n.state.myStream)}),_.createOffer().then(function(e){_.setLocalDescription(e),R.send(JSON.stringify({type:"offer",offer:e,channel:n.state.room}))}).catch(function(e){alert(e.message)})):n.setState({flashMessage:"Joined channel "+e.channelJoined+". Only you here."})},n.onReceivedRemoteConnectionOffer=function(e){n.initiateRTCPeerConnection(),_.setRemoteDescription(new RTCSessionDescription(e.offer)).then(function(){n.state.myStream.getTracks().forEach(function(e){_.addTrack(e,n.state.myStream)})}).then(function(){return _.createAnswer()}).then(function(e){return _.setLocalDescription(e),e}).then(function(t){R.send(JSON.stringify({type:"answer",answer:t,channel:e.channel,uuid:e.caller_id}))}).catch(function(e){console.log(e),n.setState({flashMessage:e.message+" on receive remote errored"})})},n.onReceivedConnectionRequestResponse=function(e){e.answer.sdp&&_.setRemoteDescription(e.answer).then(function(){return navigator.mediaDevices.getDisplayMedia()}).then(function(e){e.getTracks().forEach(function(t){return _.addTrack(t,e)})})},n.onReceivedICECandidate=function(e){_.addIceCandidate(e.candidate).catch(function(e){console.log("Failure during addIceCandidate(): "+e.name)})},n.chatRoomChanged=function(e){var t=e.target.value;n.setState({room:t})},n.audioCheckBoxChanged=function(e){n.setState({audioOn:e.target.value})},n.videoCheckBoxChanged=function(e){n.setState({videoOn:e.target.value})},n.gotMyStream=function(e){n.setState({myStream:e})},n.renderLobby=function(){return r.a.createElement("div",{className:"cam-lobby"},r.a.createElement("p",null,n.state.flashMessage),r.a.createElement(I,{width:300,media:n.state.myStream}),r.a.createElement("p",null,"Join Room: ",r.a.createElement("input",{id:"join_room_name",onChange:n.chatRoomChanged,value:n.state.room,type:"text",size:"50"})),r.a.createElement("p",null,"Audio: ",r.a.createElement("input",{id:"join_room_audio",onChange:n.audioCheckBoxChanged,type:"checkbox",checked:!0})),r.a.createElement("p",null,"Video: ",r.a.createElement("input",{id:"join_room_video",onChange:n.videoCheckBoxChanged,type:"checkbox",checked:!0})),r.a.createElement("p",null,r.a.createElement("button",{onClick:n.joinRoom},"Go")," "))},n.renderRoom=function(){return r.a.createElement("div",{className:"cam-room"},r.a.createElement("h3",null,"Room ",n.state.room),r.a.createElement("p",null,n.state.flashMessage),r.a.createElement(I,{key:"mstream",width:200,height:100,media:n.state.myStream}),n.state.remoteStreams.map(function(e,t){return console.log(e),r.a.createElement(I,{key:"remote-stream-"+t,width:100,height:100,media:e})}))},n.onClosed=function(){},n.videoRef=r.a.createRef(),n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=Object(h.a)(f.a.mark(function e(){var t,n=this;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(R=new WebSocket("ws://localhost:9090")).onopen=function(e){n.setState({signalConnected:!0})},R.onmessage=function(e){try{var t=JSON.parse(e.data);console.log("signal on msg ",e),"login"===t.type?n.onLoggedInWithSignalServer(t):"offer"===t.type?t.offer.sdp?n.onReceivedRemoteConnectionOffer(t):console.log("signal ret offer not contrain sdp",t):"answer"===t.type?n.onReceivedConnectionRequestResponse(t):"candidate"===t.type?n.onReceivedICECandidate(t):"error"===t.type&&n.setState({flashMessage:t.message})}catch(a){console.log("signal onmsg failed",a)}},e.prev=3,e.next=6,navigator.mediaDevices.getDisplayMedia();case 6:t=e.sent,this.setState({myStream:t}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),this.setState({error:e.t0.message});case 13:case"end":return e.stop()}},e,this,[[3,10]])}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.onClosed()}},{key:"render",value:function(){return r.a.createElement(g,{className:"camera",title:this.props.title,pid:this.props.pid,ipc:this.props.ipc},null!==this.state.error?r.a.createElement("div",null,"Error: ",this.state.error):0==this.state.signalConnected||null==this.state.myStream?r.a.createElement("div",null,"Connecting.."):0==this.state.enteredRoom?this.renderLobby():this.renderRoom())}}]),t}(r.a.Component),B={RTCIceServers:[{url:"stun:stun.l.google.com:19302"},{url:"turn:192.158.29.39:3478?transport=udp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"},{url:"turn:192.158.29.39:3478?transport=tcp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"}],optional:[{DtlsSrtpKeyAgreement:!0}]},A="localhost"==window.location.hostname?"ws://localhost:9091":"wss://grepawk.com/signal",P=function(){var e,t,n,a,r={},s=function(e){var t=JSON.parse(e.data);Object.keys(r).forEach(function(e){r[e](t)})},o=function(){return new Promise(function(t,n){e&&e.readyState===WebSocket.OPEN&&t(),(e=new WebSocket(A)).onopen=function(){t()},e.onmessage=s,e.onerror=function(){n()}})};function c(t){e.send(JSON.stringify(t))}return{watchStream:function(e,t){return new Promise(function(){var n=Object(h.a)(f.a.mark(function n(s,i){return f.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,o();case 2:(a=new RTCPeerConnection(B)).onicecandidate=function(e){console.log("on ice cand")},a.onnegotiationneeded=function(e){console.log("remote conn neg needed",e)},c({type:"watch_stream",channelName:e,userInfo:t}),r["watch_request_"+t.uuid]=function(){var e=Object(h.a)(f.a.mark(function e(n){var o,c;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.ok||!n.offer){e.next=19;break}return e.prev=1,o=new RTCSessionDescription(n.offer),e.next=5,a.setRemoteDescription(o);case 5:return e.next=7,a.createAnswer();case 7:return c=e.sent,e.next=10,a.setLocalDescription(c);case 10:a.ontrack=function(e){e.stream&&e.stream[0]&&s(e.stream)},delete r["watch_request_"+t.uuid],e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),i(e.t0);case 17:e.next=20;break;case 19:i(new Error("Unexpected response from server "+JSON.stringify(n)));case 20:case"end":return e.stop()}},e,null,[[1,14]])}));return function(t){return e.apply(this,arguments)}}(),setTimeout(function(){},15e3);case 8:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())},startStream:function(e,a){var s=this;return new Promise(function(){var i=Object(h.a)(f.a.mark(function i(u,l){var d;return f.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,o();case 2:return t=a,(n=new RTCPeerConnection(B)).onicecandidate=function(e){console.log("host conn on ice",e),e.candidate&&c({type:"candidate",candidate:e.candidate})},n.onnegotiationneeded=function(e){console.log("Host Connection on negotiation needed",e)},"desktop"==e&&navigator.mediaDevices.getDisplayMedia().then(function(e){document.querySelector("broadcast_preview"),s.setState({screenCaptureStream:e})}),i.prev=7,(void 0).getTracks().forEach(function(e){n.addTrack(e,void 0)}),i.next=11,n.createOffer();case 11:return d=i.sent,i.next=14,n.setLocalDescription(d);case 14:c({type:"register_stream",channel:t,offer:d}),r["register_offer_"+t]=function(e){e.ok?(delete r["register_offer_"+t],u()):l(new Error(e.error))},setTimeout(function(){delete r["register_offer_"+t],l(new Error("Broadcast request timed out"))},3e4),i.next=22;break;case 19:i.prev=19,i.t0=i.catch(7),l(i.t0);case 22:case"end":return i.stop()}},i,null,[[7,19]])}));return function(e,t){return i.apply(this,arguments)}}())}}},M=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(s)))).renderVideo=function(e,t,n){return r.a.createElement(I,{width:"100%",height:"100%",media:e})},n.renderAudio=function(){return r.a.createElement("div",null,"todo")},n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props.mediaObject[0],t=this.props.mediaObject[1],n=this.props.mediaObject[2],a={position:"absolute",left:n[0],top:n[1],width:n[2]+"%",height:n[3]+"%"};return r.a.createElement(b.a,null,r.a.createElement("div",{style:a},"screenshare"==e?this.renderVideo(t):null,"webcam"==e?this.renderVideo(t):null,"audio"==e?this.renderAudio(t):null))}}]),t}(r.a.Component),J=(n(101),{RTCIceServers:[{url:"stun:stun.l.google.com:19302"}]}),q="localhost"==window.location.hostname?"ws://localhost:9091":"wss://grepawk.com/signal";(new Date).getTime();var L=function(e){(e=e||{}).console=e.console||"console";var t,n,a=e.hostname||q,r=e.onEvent||console.log,s={},o=[];function c(){Object.values(s).forEach(function(e){e.updateTracks(o)})}return{requestStream:function(e){return new Promise(function(){var t=Object(h.a)(f.a.mark(function t(n,a){var r;return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,"screenshare"!=e){t.next=7;break}return t.next=4,navigator.mediaDevices.getDisplayMedia();case 4:r=t.sent,t.next=20;break;case 7:if("webcam"!=e){t.next=13;break}return t.next=10,navigator.mediaDevices.getUserMedia({video:!0,audio:!1});case 10:r=t.sent,t.next=20;break;case 13:if("audio"!=e){t.next=19;break}return t.next=16,navigator.mediaDevices.getUserMedia({video:!1,audio:!0});case 16:r=t.sent,t.next=20;break;case 19:a(new Error("Unkown type"));case 20:n(r||null),t.next=26;break;case 23:t.prev=23,t.t0=t.catch(0),a(t.t0);case 26:case"end":return t.stop()}},t,null,[[0,23]])}));return function(e,n){return t.apply(this,arguments)}}())},addStream:function(e,t){e.getTracks().forEach(function(){var e=Object(h.a)(f.a.mark(function e(t){var n;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=!1,o.forEach(function(e,a){e.id===t.id&&(r("existing track "+e.id),n=!0)}),!1===n&&o.push(t);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),c()},removeStream:function(e){return e.getTracks().forEach(function(e){e.stop(),o.forEach(function(t,n){t.id===e.id&&o.splice(n,1)})}),c(),null},peerConnections:s,startBroadcast:function(e){(t=new WebSocket(a)).onmessage=function(e){var a=JSON.parse(e.data);switch(r(e.data.type||""),a.type){case"registered":n=a.host_uuid;break;case"user_joined":!function(e){if(!e.client_uuid)throw new Error("unexpected user_join request");s[e.client_uuid]=function(e,t,n,a){e=e,t=t;var r=new RTCPeerConnection(J);r.onicecandidate=function(a){a.candidate&&e.send(JSON.stringify({type:"candidate",candidate:a.candidate,to_uuid:t,host_uuid:n}))},r.onnegotiationneeded=function(){var s=Object(h.a)(f.a.mark(function s(o){var c;return f.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return a("creating sdp offer for "+t),s.next=3,r.createOffer();case 3:return c=s.sent,s.next=6,r.setLocalDescription(c);case 6:e.send(JSON.stringify({type:"offer",to_uuid:t,offer:c,host_uuid:n}));case 7:case"end":return s.stop()}},s)}));return function(e){return s.apply(this,arguments)}}();var s={};return{updateTracks:function(e){e.forEach(function(e){s[e.id]?a("skip existing track"):(s[e.id]=1,a("adding new track ",e),r.addTrack(e))})},set_sdp_anwser:function(){var e=Object(h.a)(f.a.mark(function e(t){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.setRemoteDescription(t);case 3:a("Remote Anwser set"),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),a("ERROR: in set_dsp_anwser");case 9:case"end":return e.stop()}},e,null,[[0,6]])}));return function(t){return e.apply(this,arguments)}}(),addIceCandidate:function(e){a("add ice candidate "),r.addIceCandidate(e)}}}(t,e.client_uuid,n,r),s[e.client_uuid].updateTracks(o)}(a);break;case"answer":!function(e){if(!e.client_uuid||!e.answer)throw new Error("unexpected request in user_sent_peer_ice_candidate");s[e.client_uuid].set_sdp_anwser(e.answer)}(a);break;case"candidate":!function(e){if(!e.client_uuid||!e.candidate)throw new Error("unexpected request in user_sent_peer_ice_candidate");s[e.client_uuid].addIceCandidate(e.candidate),r("add peer ice candidate from "+e.client_uuid)}(a)}},t.onopen=function(n){var a,s;a={type:"register_stream",channel:e},s&&(a[s]=s),t.send(JSON.stringify(a)),r("Stream registered")},t.onerror=function(e){return r("ERROR: signalconnection not connecting",e)}}}},z={screenshare:[0,0,100,100],webcam:[0,80,20,20],audio:[90,0,10,10],textBanner:[5,5,80,10]},W=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={screenshare:!1,webcam:!1,audio:!1,streamElements:{},broadcasting:!1,broadcastEvents:[]},n.onBroadcastEvent=function(e){var t=n.state.broadcastEvents;t.push(e),n.setState({broadcastEvents:t})},n.updateStreamElements=function(e,t,a){var r=n.state.streamElements;r[e]=[e,t,a],null!==t&&!0===n.state.broadcasting&&(n.broadcastClient.addStream(t,a),n.onBroadcastEvent("Adding stream "+e)),n.setState({streamElements:r})},n.renderObjectives=function(){},n.renderPreview=function(){var e=Object.keys(n.state.streamElements);return r.a.createElement("div",null,e.map(function(e){return r.a.createElement(M,{mediaObject:n.state.streamElements[e]})}))},n.controlClicked=function(){var e=Object(h.a)(f.a.mark(function e(t){var a,r,s;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=!n.state[t],r=n.state.streamElements[t]&&n.state.streamElements[t][1]||null,e.t0=t,e.next="screenshare"===e.t0?5:"webcam"===e.t0?18:"audio"===e.t0?31:44;break;case 5:if(!a){e.next=11;break}return e.next=8,n.broadcastClient.requestStream(t);case 8:e.t1=e.sent,e.next=14;break;case 11:return e.next=13,n.broadcastClient.removeStream(r);case 13:e.t1=e.sent;case 14:return s=e.t1,n.updateStreamElements(t,s,z[t]),n.setState({screenshare:a}),e.abrupt("break",45);case 18:if(!a){e.next=24;break}return e.next=21,n.broadcastClient.requestStream(t);case 21:e.t2=e.sent,e.next=27;break;case 24:return e.next=26,n.broadcastClient.removeStream(r);case 26:e.t2=e.sent;case 27:return s=e.t2,n.updateStreamElements(t,s,z[t]),n.setState({webcam:a}),e.abrupt("break",45);case 31:if(!a){e.next=37;break}return e.next=34,n.broadcastClient.requestStream(t);case 34:e.t3=e.sent,e.next=40;break;case 37:return e.next=39,n.broadcastClient.removeStream(r);case 39:e.t3=e.sent;case 40:return s=e.t3,n.updateStreamElements(t,s,z[t]),n.setState({audio:a}),e.abrupt("break",45);case 44:return e.abrupt("break",45);case 45:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.renderConsole=function(){return r.a.createElement("div",null,n.state.broadcastEvents.map(function(e){var t;return t="object"===typeof e?JSON.stringify(e):e,r.a.createElement("p",null,t)}))},n.startBroadcasting=Object(h.a)(f.a.mark(function e(){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n.broadcastClient.startBroadcast("yisheng"),Object.values(n.state.streamElements).forEach(function(e){null!==e[1]&&n.broadcastClient.addStream(e[1],e[2])}),n.setState({broadcasting:!0});case 3:case"end":return e.stop()}},e)})),n.stopBroadcasting=function(){n.setState({broadcasting:!1})},n.renderControls=function(){return r.a.createElement("ul",{className:"list-group controls"},["screenshare","webcam","audio"].map(function(e){var t=n.state[e],a=t?e+" off":e,s=t?"btn btn-secondary":"btn btn-primary";return r.a.createElement("li",{className:"list-group-item"},r.a.createElement("button",{className:s,onClick:function(){n.controlClicked(e)}},a))}),!1===n.state.broadcasting?r.a.createElement("button",{className:"btn",onClick:n.startBroadcasting},"Start Broadcast  "):r.a.createElement("button",{className:"btn",onClick:n.stopBroadcasting},"Stop Broadcast"))},n.broadcastClient=L({onEvent:n.onBroadcastEvent,console:"console"}),n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return r.a.createElement(g,{className:"stream",title:this.props.title,pid:this.props.pid,ipc:this.props.ipc,draggable:!1},this.state.flashMessage?r.a.createElement("div",null,this.state.flashMessage):null,r.a.createElement("div",{className:"obs"},this.renderControls(),r.a.createElement("div",{className:"preview",ref:this.previewDiv},this.renderPreview()),r.a.createElement("div",{className:"objectives"},this.renderObjectives()),r.a.createElement("div",{className:"console"},this.renderConsole())))}}]),t}(r.a.Component),U=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(n=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(r)))).state={streamLoaded:!1,flashMessage:null,remoteStream:null,streamURI:n.props.args.length>0&&n.props.args[0]||n.props.userInfo.username},n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this;P().watchStream(this.state.streamURI,this.props.userInfo).then(function(t){e.setState({streamLoaded:!0,remoteStream:t})}).catch(function(t){e.setState({flashMessage:t.message})})}},{key:"render",value:function(){return r.a.createElement(g,{className:"watch",title:this.props.title,pid:this.props.pid,ipc:this.props.ipc},this.state.flashMessage?r.a.createElement("div",null,this.state.flashMessage):null,this.state.remoteStream?r.a.createElement(I,{media:this.state.remoteStream}):"Loading..")}}]),t}(r.a.Component),V=(n(102),n(108),function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).iconClicked=n.iconClicked.bind(Object(d.a)(n)),n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"iconClicked",value:function(e){var t=this.props.icons[e];this.props.ipc(t.cmd,t.args)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"app-icon-grid"},this.props.icons.map(function(t,n){var a=(n+1)%5,s=Math.floor((n+1)/5),o={gridColumnStart:s,gridColumnEnd:s+1,gridRowStart:a,gridRowEnd:a+1,width:50,height:50,borderColor:"black",borderWidth:2};return r.a.createElement("div",{key:"icon"+n,style:o,onClick:function(){e.iconClicked(n)}},r.a.createElement("i",{className:"fas fa-lg fa-"+t.name}),r.a.createElement("br",null),t.title)}))}}]),t}(r.a.Component)),G=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={processes:[{name:"tty",state:"on"}],userInfo:{name:"guest",xp:0,gold:0},quests:[],icons:[{name:"terminal",title:"terminal",cmd:"tty",args:[]},{name:"broadcast-tower",title:"Broadcast",cmd:"stream",args:[]}]},n.push_proc=function(e){},n.ipc=n.ipc.bind(Object(d.a)(n)),n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){if(window.location.hash){var e=window.location.hash.replace("#","").split("/"),t=e[0],n=e.splice(1);this.ipc(t,n)}}},{key:"ipc",value:function(e,t){switch(e){case"close":var n=t[0],a=this.state.processes;a[n]="closed",this.setState({processes:a});break;case"cam":case"camera":var r=this.state.processes.concat({name:"camera"});this.setState({processes:r});break;case"broadcast":case"stream":r=this.state.processes.concat({name:"stream",args:t});this.setState({processes:r});break;case"watch":r=this.state.processes.concat({name:"watch",args:t});this.setState({processes:r});break;case"tty":r=this.state.processes.concat({name:"tty",args:t});this.setState({processes:r});break;case"hud-update":this.setState({userInfo:t});break;case"questlist":this.setState({quests:t})}}},{key:"renderBody",value:function(){var e=this;return this.state.processes.map(function(t,n){return console.log(t,n),"off"===t.state?null:"tty"===t.name?r.a.createElement(x,{key:"tty1",pid:n,title:"tty",ipc:e.ipc}):"camera"===t.name?r.a.createElement(D,{userInfo:e.state.userInfo,pid:n,title:"Face 2 Face",ipc:e.ipc}):"stream"===t.name?r.a.createElement(W,{args:t.args,pid:n,title:"Broadcast",ipc:e.ipc}):"watch"===t.name?r.a.createElement(U,{userInfo:e.state.userInfo,args:t.args,pid:n,title:"Watch",ipc:e.ipc}):void 0})}},{key:"renderHud",value:function(){return this.state.userInfo?r.a.createElement(C,{username:this.state.userInfo.username,cwd:this.state.userInfo.cwd,fname:this.state.userInfo.fname,xp:this.state.userInfo.xp,gold:this.state.userInfo.gold}):null}},{key:"renderQuestView",value:function(){return r.a.createElement(j,{className:"quest-list",title:"quests",list:this.state.quests})}},{key:"renderBackground",value:function(){return r.a.createElement(V,{icons:this.state.icons,ipc:this.ipc})}},{key:"render",value:function(){return r.a.createElement("div",{className:"desktop"},r.a.createElement("nav",{className:"navbar navbar-light bg-light"},r.a.createElement("a",{className:"navbar-brand",href:"#"},"GrepAwk"),this.renderHud()),this.renderBackground(),this.renderBody(),this.renderQuestView())}}]),t}(r.a.Component);o.a.render(r.a.createElement(G,null),document.getElementById("root"))},44:function(e,t,n){e.exports=n(109)},49:function(e,t,n){},50:function(e,t,n){},52:function(e,t,n){},53:function(e,t,n){},92:function(e,t){}},[[44,1,2]]]);
//# sourceMappingURL=main.1125e320.chunk.js.map