(window["webpackJsonpmy-app"]=window["webpackJsonpmy-app"]||[]).push([[0],{102:function(e,t,n){},103:function(e,t,n){},104:function(e,t){},111:function(e,t,n){},112:function(e,t,n){},113:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(24),s=n.n(i),o=(n(50),n(3)),c=n(4),u=n(6),l=n(5),d=n(11),p=n(7),m=(n(51),n(1)),f=n.n(m),h=n(2),v=(n(53),n(25)),b=n.n(v);var w=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).onNavBarClick=function(e){var t=e.target.className;"maximize"===t?n.setState(function(e){return{maximized:!e.maximized}}):"minimize"===t?n.setState(function(e){return{minimized:!e.minimized}}):"close"===t&&(n.setState({closed:!0}),n.props.ipc("close",[n.props.pid]))},n.renderNavTop=function(){return r.a.createElement("div",{className:"title",onMouseDown:n.onNavbarMouseDown},r.a.createElement("button",{className:"close",onClick:n.onNavBarClick},"x"),r.a.createElement("button",{className:"maximize",onClick:n.onNavBarClick},"[]"),r.a.createElement("button",{className:"minimize",onClick:n.onNavBarClick},"_"),r.a.createElement("p",{className:"title"},n.props.title))},n.onNavbarMouseDown=function(e){window.addEventListener("mousemove",n.onNavbarMouseMove),window.addEventListener("mouseup",n.onNavbarMouseUp);var t=e.clientX,a=e.clientY;n.setState({lastMouseX:t,lastMouseY:a,isDragging:!0})},n.onNavbarMouseUp=function(e){window.removeEventListener("mouseup",n.onNavbarMouseUp),window.removeEventListener("mousemove",n.onNavbarMouseMove)},n.onNavbarMouseMove=function(e){var t=e.clientX,a=e.clientY;if(!1!==n.state.dragging){var r=t-n.state.lastMouseX,i=a-n.state.lastMouseY;n.setState({left:n.state.left+r,top:n.state.top+i,lastMouseX:t,lastMouseY:a,maximized:!1,minimized:!1})}},n.onCornerMouseDown=function(e){window.addEventListener("mousemove",n.onCornerMouseMove),window.addEventListener("mouseup",n.onCornerMouseUp);var t=e.clientX,a=e.clientY;n.setState({lastMouseX:t,lastMouseY:a,maximized:!1,minimized:!1,isResizing:!0})},n.onCornerMouseUp=function(e){n.setState({isResizing:!1,lastMouseX:0,lastMouseY:0}),window.removeEventListener("mouseup",n.onCornerMouseUp),window.removeEventListener("mousemove",n.onCornerMouseUp)},n.onCornerMouseMove=function(e){var t=e.clientX,a=e.clientY;if(!1!==n.state.isResizing){var r=t-n.state.lastMouseX,i=a-n.state.lastMouseY;n.setState({width:n.state.width+r,height:n.state.height+i,lastMouseX:t,lastMouseY:a})}},n.renderFooter=function(){return r.a.createElement("div",{className:"footer",onMouseDown:n.onCornerMouseDown},r.a.createElement("span",null,n.props.windowInfo),r.a.createElement("span",{className:"corner",style:{float:"right"}}))},n.state={minimized:!1,maximized:!1,closed:!1,isResizing:!1,isDragging:!1,top:10,left:500,width:800,height:400,lastMouseX:0,lastMouseY:0},n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){if(this.state.closed)return null;var e="box";this.props.className&&(e=this.props.className+" "+e);var t={top:this.state.maximized?0:this.state.top,left:this.state.maximized?0:this.state.left,width:this.state.maximized?"100%":this.state.width,cursor:this.state.isResizing?"se-resize":"cursor",height:this.state.minimized?18:this.state.maximized?"100%":this.state.height};return r.a.createElement("div",{className:e,style:t},this.renderNavTop(),r.a.createElement("div",{className:"body"},this.props.children),r.a.createElement("div",{className:"footer",onMouseDown:this.onCornerMouseDown},r.a.createElement("span",null,this.props.windowInfo),r.a.createElement("span",{className:"corner",style:{cursor:"se-resize",float:"right"}})))}}]),t}(r.a.Component),g=(n(54),n(55).Parser,function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).renderHeaders=function(){return n.props.headers?r.a.createElement("thead",null,r.a.createElement("tr",{key:"tbtrh1"},n.props.headers.map(function(e,t){return r.a.createElement("th",{key:"th"+t},e)}))):null},n.renderLink=function(e,t){return r.a.createElement("span",{ref:r.a.createRef(),className:"terminal-link",onClick:function(){n.props.clickedCmd(e)}},t)},n.renderBody=function(){return n.props.rows?r.a.createElement("tbody",null,n.props.rows.map(function(e){return n.renderTableRow(e)})):null},n.renderTableRow=function(e){return r.a.createElement("tr",null,n.props.headers.map(function(t){var a=e[t]||"";if("opts"==t){var i=a[0];return r.a.createElement("td",null,n.renderLink(i.cmd,i.desc))}if("thumbnail"===t){var s=a;return r.a.createElement("td",null,r.a.createElement("img",{width:120,src:s}))}return r.a.createElement("td",null,a)}))},n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("table",{className:this.props.className||"table",border:"1"},this.renderHeaders(),this.renderBody())}}]),t}(r.a.Component)),y=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:this.props.className},r.a.createElement("h5",null,this.props.title),r.a.createElement("ul",null,this.props.list&&this.props.list.map?this.props.list.map(function(e,t){return r.a.createElement("li",{key:"list-"+t},r.a.createElement("h5",{className:"list-header"},e.title),r.a.createElement("div",{className:"list-body"},e.description))}):null))}}]),t}(r.a.Component),k=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).componentDidMount=function(){},n.renderFileSelectedList=function(){return r.a.createElement(y,{headers:["name","size","type"],rows:n.state.files_selected})},n.renderControlPanel=function(){return"new"===n.state.status?r.a.createElement("div",{className:"ctrl-panel"},r.a.createElement("button",{className:"btn btn-secondary",onClick:n.onCancel},"Cancel"),r.a.createElement("button",{className:"btn btn-primary",onClick:n.onSave}," Save")):r.a.createElement("div",null)},n.onFileChange=function(e){},n.onSave=function(e){},n.onCancel=function(e){alert("cancel")},n.state={files_selected:[],status:"new"},n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"anchor"},r.a.createElement("input",{type:"file",className:"form-control",id:"file-select-input",name:"file",onChange:this.props.onFilesChange||this.onFileChange}),this.renderFileSelectedList(),this.renderControlPanel())}}]),t}(r.a.Component),E=null,x="localhost"==window.location.hostname?"ws://localhost:8081":"wss://grepawk.com/ws";function O(){var e=localStorage.getItem("uuid");if(e)return e;e=function(){var e=(new Date).getTime();return"undefined"!==typeof performance&&"function"===typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)})}(),localStorage.setItem("uuid",e)}var C=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={socket:E,output_rows:[],output_cursor_position:0,uuid:O()},n.initSocket=function(){return new Promise(function(e,t){if(E&&E.readyState===WebSocket.OPEN)e();else{if(E&&E.readyState===WebSocket.CONNECTING)return n.onAddOutputRow({type:"text",data:"Connecting.."}),void e();(E=new WebSocket(x)).onopen=function(t){clearTimeout(a),E.send("check-in "+n.state.uuid),e()};var a=setTimeout(function(){E.readyState,WebSocket.OPEN},5e3)}})},n.onAddOutputRow=function(e){var t=n.state.output_rows.concat(e);n.setState({output_rows:t})},n.parseAPIResponse=function(e){e.stdout&&n.onAddOutputRow({type:"text",data:e.stdout}),e.stderr&&n.onAddOutputRow({type:"text",data:e.stderr}),e.table&&n.onAddOutputRow({type:"table",data:e.table}),e.userInfo&&(localStorage.setItem("uuid",e.userInfo.uuid),n.props.ipc("hud-update",e.userInfo)),e.quests&&n.props.ipc("questlist",e.quests),e.hint},n.renderOutputRow=function(e,t){switch(e.type){case"stdout":case"text":return r.a.createElement("pre",{key:"op-"+t}," ",e.data);case"stderr":return r.a.createElement("pre",{key:"op-"+t}," ",r.a.createElement("span",{style:{color:"red"}},e.data));case"stdin":return r.a.createElement("div",{className:"input-line",key:"op-"+t},r.a.createElement("div",{className:"prompt"},">"),r.a.createElement("input",{className:"cmdline input-line",disabled:!0,value:e.data}));case"table":return r.a.createElement("div",{key:"op-"+t},r.a.createElement(g,{clickedCmd:n.stdin,className:"table table-dark",headers:e.data.headers,rows:e.data.rows}));case"imageLink":return r.a.createElement("div",{key:"op-"+t},r.a.createElement("img",{src:e.data}));case"filelink":return r.a.createElement("div",{key:"op-"+t},r.a.createElement("iframe",{src:e.data}));case"upload":return r.a.createElement(k,null)}},n.keyboardLoaded=function(e){e.target.focus()},n.windowLoaded=function(e){document.getElementsByClassName("terminal-body").scrollTo(0,100),e.target.offsetHeight=1e3},n.stdin=function(e){n.onAddOutputRow({type:"stdin",cmd:e}),n.locallyProcessed(e)||E.send(e)},n.keyboardPressed=function(e){13==e.keyCode&&(n.stdin(e.target.value),e.target.value="")},n.renderInputBar=function(){return r.a.createElement("div",{className:"input-line"},r.a.createElement("div",{id:"stdin-prompt",className:"prompt"}," > "),r.a.createElement("input",{autoFocus:!0,onLoad:n.keyboardLoaded,onKeyDown:n.keyboardPressed,size:"80",id:"terminal_input",autoComplete:"off",className:"cmdline input-line"}))},n.clickOnTerminal=function(e){document.getElementById("terminal_input").focus()},n.scrollToBottom=function(){n.messagesEnd.scrollIntoView({behavior:"smooth"})},n.prompt=r.a.createRef(),n.promptInput=r.a.createRef(),n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=Object(h.a)(f.a.mark(function e(){var t=this;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initSocket();case 2:E.onmessage=function(e){if("object"===typeof e.data){var n=new Image;n.src=URL.createObjectURL(e.data),t.onAddOutputRow({type:"image",data:n})}else if(e.data&&e.data.startsWith("stdout: ")){var a=e.data.replace("stdout: ","");t.onAddOutputRow({type:"text",data:a})}else if(e.data&&e.data.startsWith("stderr: ")){a=e.data.replace("stderr: ","");t.onAddOutputRow({type:"text",data:a})}else t.parseAPIResponse(JSON.parse(e.data))};case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"locallyProcessed",value:function(e){if(!e)return!1;var t=e.split(" "),n=t[0],a=t.splice(1);switch(console.log(n,a),n){case"upload":this.onAddOutputRow({type:"upload",data:a[0]});break;case"openimage":return this.onAddOutputRow({type:"imageLink",data:a[0]}),!0;case"edit":return this.props.ipc(n,a),!0;case"cam":case"new":case"stream":case"broadcast":case"draw":case"watch":return this.props.ipc(n,a),!0;default:return!1}}},{key:"render",value:function(){var e=this;return r.a.createElement(w,{className:"terminal",title:this.props.title,pid:this.props.pid,ipc:this.props.ipc},r.a.createElement("div",{className:"terminal-body",onClick:this.clickOnTerminal},this.state.output_rows.map(function(t,n){return e.renderOutputRow(t,n)}),this.renderInputBar(),r.a.createElement("div",{className:"terminal-anchor",ref:function(t){e.messagesEnd=t}}," ")))}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}}]),t}(r.a.Component),j={float:"right",marginRight:"15px",height:"20px"},S=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("span",{style:j,className:"HUD"},"Name: ",this.props.fname||this.props.username||"guest",", Location: ",this.props.cwd||"root",", XP Level:",this.props.xp||0,", Gold:",this.props.points||0)}}]),t}(r.a.Component),N=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.video.srcObject=this.props.media}},{key:"shouldComponentUpdate",value:function(e){return this.props.media!==e.media}},{key:"componentDidUpdate",value:function(){this.video.srcObject=this.props.media}},{key:"render",value:function(){var e=this,t=this.props,n=t.width,a=t.height,i=t.muted,s=t.children;return r.a.createElement("video",{height:a,width:n,muted:i,autoPlay:!0,playsInLine:!0,ref:function(t){e.video=t}},s)}}]),t}(r.a.Component);N.defaultProps={children:null,height:420,width:640,muted:!0,media:null};var _,R,M=N,D={RTCIceServers:[{url:"stun:stun.l.google.com:19302"},{url:"turn:192.158.29.39:3478?transport=udp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"},{url:"turn:192.158.29.39:3478?transport=tcp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"}],optional:[{DtlsSrtpKeyAgreement:!0}]},T=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={enteredRoom:!1,signalConnected:!1,videoOn:!0,audioOn:!0,flashMessage:"",error:null,myStream:null,room:n.props.room||"default",isHost:null,remoteStreams:[]},n.joinRoom=Object(h.a)(f.a.mark(function e(){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n.setState({enteredRoom:!0}),_.send(JSON.stringify({type:"login",channel:n.state.room,uuid:n.props.userInfo.uuid}));case 2:case"end":return e.stop()}},e)})),n.initiateRTCPeerConnection=function(){return(R=new RTCPeerConnection(D)).ontrack=function(e){if(e.streams&&e.streams[0]){var t=n.state.remoteStreams.concat(e.streams[0]);n.setState({remoteStreams:t})}},R.onicecandidateerror=function(e){n.setState({flashMessage:e.message})},R.onicecandidate=function(e){null!=e.candidate&&_.send(JSON.stringify({type:"candidate",candidate:e.candidate,channel:n.state.room}))},R},n.onLoggedInWithSignalServer=function(e){n.setState({signalConnected:!0}),1!=e.usersCount?(n.initiateRTCPeerConnection(),R.onnegotiationneeded=function(e){R.createOffer().then(function(e){R.setLocalDescription(e),_.send(JSON.stringify({type:"offer",offer:e,channel:n.state.room}))}).catch(function(e){alert(e.message)})},n.state.myStream.getTracks(function(e){R.addTrack(e,n.state.myStream)}),R.createOffer().then(function(e){R.setLocalDescription(e),_.send(JSON.stringify({type:"offer",offer:e,channel:n.state.room}))}).catch(function(e){alert(e.message)})):n.setState({flashMessage:"Joined channel "+e.channelJoined+". Only you here."})},n.onReceivedRemoteConnectionOffer=function(e){n.initiateRTCPeerConnection(),R.setRemoteDescription(new RTCSessionDescription(e.offer)).then(function(){n.state.myStream.getTracks().forEach(function(e){R.addTrack(e,n.state.myStream)})}).then(function(){return R.createAnswer()}).then(function(e){return R.setLocalDescription(e),e}).then(function(t){_.send(JSON.stringify({type:"answer",answer:t,channel:e.channel,uuid:e.caller_id}))}).catch(function(e){console.log(e),n.setState({flashMessage:e.message+" on receive remote errored"})})},n.onReceivedConnectionRequestResponse=function(e){e.answer.sdp&&R.setRemoteDescription(e.answer).then(function(){return navigator.mediaDevices.getDisplayMedia()}).then(function(e){e.getTracks().forEach(function(t){return R.addTrack(t,e)})})},n.onReceivedICECandidate=function(e){R.addIceCandidate(e.candidate).catch(function(e){console.log("Failure during addIceCandidate(): "+e.name)})},n.chatRoomChanged=function(e){var t=e.target.value;n.setState({room:t})},n.audioCheckBoxChanged=function(e){n.setState({audioOn:e.target.value})},n.videoCheckBoxChanged=function(e){n.setState({videoOn:e.target.value})},n.gotMyStream=function(e){n.setState({myStream:e})},n.renderLobby=function(){return r.a.createElement("div",{className:"cam-lobby"},r.a.createElement("p",null,n.state.flashMessage),r.a.createElement(M,{width:300,media:n.state.myStream}),r.a.createElement("p",null,"Join Room: ",r.a.createElement("input",{id:"join_room_name",onChange:n.chatRoomChanged,value:n.state.room,type:"text",size:"50"})),r.a.createElement("p",null,"Audio: ",r.a.createElement("input",{id:"join_room_audio",onChange:n.audioCheckBoxChanged,type:"checkbox",checked:!0})),r.a.createElement("p",null,"Video: ",r.a.createElement("input",{id:"join_room_video",onChange:n.videoCheckBoxChanged,type:"checkbox",checked:!0})),r.a.createElement("p",null,r.a.createElement("button",{onClick:n.joinRoom},"Go")," "))},n.renderRoom=function(){return r.a.createElement("div",{className:"cam-room"},r.a.createElement("h3",null,"Room ",n.state.room),r.a.createElement("p",null,n.state.flashMessage),r.a.createElement(M,{key:"mstream",width:200,height:100,media:n.state.myStream}),n.state.remoteStreams.map(function(e,t){return console.log(e),r.a.createElement(M,{key:"remote-stream-"+t,width:100,height:100,media:e})}))},n.onClosed=function(){},n.videoRef=r.a.createRef(),n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=Object(h.a)(f.a.mark(function e(){var t,n=this;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(_=new WebSocket("ws://localhost:9090")).onopen=function(e){n.setState({signalConnected:!0})},_.onmessage=function(e){try{var t=JSON.parse(e.data);console.log("signal on msg ",e),"login"===t.type?n.onLoggedInWithSignalServer(t):"offer"===t.type?t.offer.sdp?n.onReceivedRemoteConnectionOffer(t):console.log("signal ret offer not contrain sdp",t):"answer"===t.type?n.onReceivedConnectionRequestResponse(t):"candidate"===t.type?n.onReceivedICECandidate(t):"error"===t.type&&n.setState({flashMessage:t.message})}catch(a){console.log("signal onmsg failed",a)}},e.prev=3,e.next=6,navigator.mediaDevices.getDisplayMedia();case 6:t=e.sent,this.setState({myStream:t}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),this.setState({error:e.t0.message});case 13:case"end":return e.stop()}},e,this,[[3,10]])}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.onClosed()}},{key:"render",value:function(){return r.a.createElement(w,{className:"camera",title:this.props.title,pid:this.props.pid,ipc:this.props.ipc},null!==this.state.error?r.a.createElement("div",null,"Error: ",this.state.error):0==this.state.signalConnected||null==this.state.myStream?r.a.createElement("div",null,"Connecting.."):0==this.state.enteredRoom?this.renderLobby():this.renderRoom())}}]),t}(r.a.Component),I=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return(n=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(i)))).renderVideo=function(e,t,n){return r.a.createElement(M,{width:"100%",height:"100%",media:e})},n.renderAudio=function(){return r.a.createElement("div",null,"todo")},n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.mediaObject[0],t=this.props.mediaObject[1],n=this.props.mediaObject[2],a={position:"absolute",left:n[0]+"%",top:n[1]+"%",width:n[2]+"%",height:n[3]+"%"};return this.props.notDraggable?r.a.createElement("div",{style:a},"video"==e?this.renderVideo(t):null,"screenshare"==e?this.renderVideo(t):null,"webcam"==e?this.renderVideo(t):null,"audio"==e?this.renderAudio(t):null):r.a.createElement(b.a,null,r.a.createElement("div",{style:a},"video"==e?this.renderVideo(t):null,"screenshare"==e?this.renderVideo(t):null,"webcam"==e?this.renderVideo(t):null,"audio"==e?this.renderAudio(t):null))}}]),t}(r.a.Component),P=(n(102),{RTCIceServers:[{url:"stun:stun.l.google.com:19302"}]}),B="localhost"==window.location.hostname?"ws://localhost:9091":"wss://grepawk.com/signal";var L=function(e){(e=e||{}).console=e.console||"console";var t,n,a=e.hostname||B,r=e.onEvent||console.log,i={},s=[];function o(e,t,n){return{id:e,track:t,dimensions:n,live:!0}}function c(){Object.values(i).forEach(function(e){e.updateTracks(s)})}return{requestUserStream:function(e){return new Promise(function(){var t=Object(h.a)(f.a.mark(function t(n,a){var r;return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,"screenshare"!=e){t.next=7;break}return t.next=4,navigator.mediaDevices.getDisplayMedia();case 4:r=t.sent,t.next=20;break;case 7:if("webcam"!=e){t.next=13;break}return t.next=10,navigator.mediaDevices.getUserMedia({video:!0,audio:!1});case 10:r=t.sent,t.next=20;break;case 13:if("audio"!=e){t.next=19;break}return t.next=16,navigator.mediaDevices.getUserMedia({video:!1,audio:!0});case 16:r=t.sent,t.next=20;break;case 19:a(new Error("Unkown type"));case 20:n(r||null),t.next=26;break;case 23:t.prev=23,t.t0=t.catch(0),a(t.t0);case 26:case"end":return t.stop()}},t,null,[[0,23]])}));return function(e,n){return t.apply(this,arguments)}}())},addStream:function(e,t){e.getTracks().forEach(function(e){!function(e,t){for(var n in s)s[n].id===e.id&&(s[n]=o(e.id,e,t));s.push(o(e.id,e,t))}(e,t)}),c()},removeStream:function(e){return e.getTracks().forEach(function(e){!function(e){for(var t in s)s[t].id===e.id&&(s[t].live=!1)}(e),e.stop()}),c(),null},peerConnections:i,startBroadcast:function(e){(t=new WebSocket(a)).onmessage=function(e){var a=JSON.parse(e.data);switch(r(e.data.type||""),a.type){case"registered":n=a.host_uuid;break;case"user_joined":!function(e){if(!e.client_uuid)throw new Error("unexpected user_join request");i[e.client_uuid]=function(e,t,n,a){e=e,t=t;var r=new RTCPeerConnection(P),i=r.createDataChannel("metadata"),s={};function o(){if(!i||"open"!==i.readyState)return a("metadata channel not yet o0pen"),void setTimeout(o,1e3);var e=[];Object.keys(s).forEach(function(t){var n=s[t];e.push({trackId:n.id,dimensions:n.dimensions,live:n.active})});var t={type:"mediaMetadata",data:e};a("sending metadata ",t),i.send(JSON.stringify(t))}return i.onopen=function(){a("Meta channel open with "+t),o()},r.onicecandidate=function(a){a.candidate&&e.send(JSON.stringify({type:"candidate",candidate:a.candidate,to_uuid:t,host_uuid:n}))},r.onnegotiationneeded=function(){var i=Object(h.a)(f.a.mark(function i(s){var o;return f.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return a("creating sdp offer for "+t),i.next=3,r.createOffer();case 3:return o=i.sent,i.next=6,r.setLocalDescription(o);case 6:e.send(JSON.stringify({type:"offer",to_uuid:t,offer:o,host_uuid:n}));case 7:case"end":return i.stop()}},i)}));return function(e){return i.apply(this,arguments)}}(),{updateTracks:function(e){for(var t in e){var n=e[t].id;"undefined"===typeof s[n]&&(s[n]=e[t],e[t].live&&r.addTrack(e[t].track))}o()},set_sdp_anwser:function(){var e=Object(h.a)(f.a.mark(function e(t){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.setRemoteDescription(t);case 3:a("Remote Anwser set"),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),a("ERROR: in set_dsp_anwser");case 9:case"end":return e.stop()}},e,null,[[0,6]])}));return function(t){return e.apply(this,arguments)}}(),addIceCandidate:function(e){a("add ice candidate "),r.addIceCandidate(e)}}}(t,e.client_uuid,n,r),i[e.client_uuid].updateTracks(s)}(a);break;case"answer":!function(e){if(!e.client_uuid||!e.answer)throw new Error("unexpected request in user_sent_peer_ice_candidate");i[e.client_uuid].set_sdp_anwser(e.answer)}(a);break;case"candidate":!function(e){if(!e.client_uuid||!e.candidate)throw new Error("unexpected request in user_sent_peer_ice_candidate");i[e.client_uuid].addIceCandidate(e.candidate),r("add peer ice candidate from "+e.client_uuid)}(a)}},t.onopen=function(n){var a,i;a={type:"register_stream",channel:e},i&&(a[i]=i),t.send(JSON.stringify(a)),r("Stream registered "+e)},t.onerror=function(e){return r("ERROR: signalconnection not connecting",e)}}}},A={screenshare:[0,0,100,100],webcam:[0,80,20,20],audio:[90,0,10,10],textBanner:[5,5,80,10]},F=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={screenshare:!1,webcam:!1,audio:!1,streamElements:{},broadcasting:!1,broadcastEvents:[]},n.onBroadcastEvent=function(e){var t=n.state.broadcastEvents;t.push(e),n.setState({broadcastEvents:t})},n.updateStreamElements=function(e,t,a){var r=n.state.streamElements;r[e]=[e,t,a],null!==t&&!0===n.state.broadcasting&&(n.broadcastClient.addStream(t,a),n.onBroadcastEvent("Adding stream "+e)),n.setState({streamElements:r})},n.renderObjectives=function(){},n.renderPreview=function(){var e=Object.keys(n.state.streamElements);return r.a.createElement("div",null,e.map(function(e){return r.a.createElement(I,{mediaObject:n.state.streamElements[e]})}))},n.controlClicked=function(){var e=Object(h.a)(f.a.mark(function e(t){var a,r,i;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=!n.state[t],r=n.state.streamElements[t]&&n.state.streamElements[t][1]||null,e.t0=t,e.next="screenshare"===e.t0?5:"webcam"===e.t0?18:"audio"===e.t0?31:44;break;case 5:if(!a){e.next=11;break}return e.next=8,n.broadcastClient.requestUserStream(t);case 8:e.t1=e.sent,e.next=14;break;case 11:return e.next=13,n.broadcastClient.removeStream(r);case 13:e.t1=e.sent;case 14:return i=e.t1,n.updateStreamElements(t,i,A[t]),n.setState({screenshare:a}),e.abrupt("break",45);case 18:if(!a){e.next=24;break}return e.next=21,n.broadcastClient.requestUserStream(t);case 21:e.t2=e.sent,e.next=27;break;case 24:return e.next=26,n.broadcastClient.removeStream(r);case 26:e.t2=e.sent;case 27:return i=e.t2,n.updateStreamElements(t,i,A[t]),n.setState({webcam:a}),e.abrupt("break",45);case 31:if(!a){e.next=37;break}return e.next=34,n.broadcastClient.requestUserStream(t);case 34:e.t3=e.sent,e.next=40;break;case 37:return e.next=39,n.broadcastClient.removeStream(r);case 39:e.t3=e.sent;case 40:return i=e.t3,n.updateStreamElements(t,i,A[t]),n.setState({audio:a}),e.abrupt("break",45);case 44:return e.abrupt("break",45);case 45:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.renderConsole=function(){return r.a.createElement("div",null,n.state.broadcastEvents.map(function(e){var t;return t="object"===typeof e?JSON.stringify(e):e,r.a.createElement("p",null,t)}))},n.startBroadcasting=Object(h.a)(f.a.mark(function e(){var t;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.channelName,n.channelName||(n.channelName=prompt("What channel name do you want?")),n.channelName){e.next=4;break}return e.abrupt("return");case 4:window.confirm("Start broadcasting at https://grepawk.com/c/"+t+" now?")&&(n.broadcastClient.startBroadcast(t),Object.values(n.state.streamElements).forEach(function(e){null!==e[1]&&n.broadcastClient.addStream(e[1],e[2])}),n.setState({broadcasting:!0}));case 6:case"end":return e.stop()}},e)})),n.stopBroadcasting=function(){n.setState({broadcasting:!1})},n.renderControls=function(){return r.a.createElement("ul",{className:"list-group controls"},["screenshare","webcam","audio"].map(function(e){var t=n.state[e],a=t?e+" off":e,i=t?"btn btn-secondary":"btn btn-primary";return r.a.createElement("li",{className:"list-group-item"},r.a.createElement("button",{className:i,onClick:function(){n.controlClicked(e)}},a))}))},n.renderHeader=function(){return r.a.createElement("div",{className:"header"},!1===n.state.broadcasting?r.a.createElement("a",{href:"javascript://",onClick:n.startBroadcasting},"Start Broadcast  "):r.a.createElement("a",{href:"javascript://",onClick:n.stopBroadcasting},"Stop Broadcast"))},n.broadcastClient=L({onEvent:n.onBroadcastEvent,console:"console"}),n.channelName=n.props.args[0],n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return r.a.createElement(w,{className:"stream",title:this.props.title,pid:this.props.pid,ipc:this.props.ipc,draggable:!1},this.state.flashMessage?r.a.createElement("div",null,this.state.flashMessage):null,r.a.createElement("div",{className:"obs"},this.renderHeader(),this.renderControls(),r.a.createElement("div",{className:"preview",ref:this.previewDiv},this.renderPreview()),r.a.createElement("div",{className:"console"},this.renderConsole()),r.a.createElement("div",{className:"objectives"},this.renderObjectives())))}}]),t}(r.a.Component),z="localhost"==window.location.hostname?"ws://localhost:9091":"wss://grepawk.com/signal",U={RTCIceServers:[{url:"stun:stun.l.google.com:19302"}]};var J=function(e){var t,n,a,r=e.hostname||z,i=e.onEvent||console.log,s=e.mediaObjectReady,o=(e.mediaObjectOffline,{}),c={};function u(){return(u=Object(h.a)(f.a.mark(function e(r,u){var l,d;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l=function(){for(var e in i("showing remote tracks: "+Object.keys(c).length),c){var t=c[e];if(o[e]){var n=new MediaStream;n.addTrack(o[e]),s(e,n,o[e].kind,t.dimensions),i("showing tracking ")}else i("Got meta data but not track")}},a=u,(n=new RTCPeerConnection(U)).ondatachannel=function(e){e.channel.onopen=function(){return i("metadata channel on client open")},e.channel.onmessage=function(e){i("got metadata "+e.data);var t=JSON.parse(e.data);"mediaMetadata"==t.type&&t.data.forEach(function(e){var t=e.trackId;c[t]=e});l()}},n.onicecandidate=function(e){i("client on ice candidate ",e),e.candidate&&t.send(JSON.stringify({type:"candidate",to_uuid:a,candidate:e.candidate}))},n.ontrack=function(e){e.track&&(o[e.track.id]=e.track),l()},e.next=8,n.setRemoteDescription(new RTCSessionDescription(r));case 8:return e.next=10,n.createAnswer();case 10:d=e.sent,n.setLocalDescription(d),t.send(JSON.stringify({type:"answer",to_uuid:a,answer:d}));case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}return{watchChannel:function(e){(t=new WebSocket(r)).onopen=function(a){t.send(JSON.stringify({type:"watch_stream",channel:e})),t.onmessage=function(e){var t=JSON.parse(e.data);switch(i("Signal Server msg type "+t.type),t.type){case"offer":i("got offer: host_uuid=",t.host_uuid),function(e,t){u.apply(this,arguments)}(t.offer,t.host_uuid);break;case"candidate":i("got candidate"),n.addIceCandidate(t.candidate);break;case"error":i("Error: "+t.message)}}}}}},q=(n(103),function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={broadcastEvents:[],media:{}},n.mediaObjectReady=function(e,t,a,r){var i=n.state.media;i[e]=[a,t,r],n.setState({media:i})},n.mediaObjectOffline=function(e){var t=n.state.media;delete t[e],n.setState({media:t})},n.onBroadcastEvent=function(e){var t=n.state.broadcastEvents;t.push(e),n.setState({broadcastEvents:t})},n.renderStream=function(){var e=Object.keys(n.state.media);return console.log("Rendering "+e.length+" stream parts"),r.a.createElement("div",{className:"stream-content"},e.map(function(e,t){return r.a.createElement(I,{key:t,notDraggable:!0,mediaObject:n.state.media[e]})}))},n.renderConsole=function(){return r.a.createElement("div",{className:"console-watcher"},n.state.broadcastEvents.map(function(e,t){var n;return n="object"===typeof e?JSON.stringify(e):e,r.a.createElement("p",{key:t},n)}))},n.broadcastViewerClient=J({channelName:n.props.channelName,onEvent:n.onBroadcastEvent,mediaObjectReady:n.mediaObjectReady,mediaObjectOffline:n.mediaObjectReady}),n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.broadcastViewerClient.watchChannel(this.props.channelName)}},{key:"render",value:function(){return r.a.createElement(w,{className:"watch-stream",title:this.props.title,pid:this.props.pid,ipc:this.props.ipc,draggable:!1},r.a.createElement("div",{key:"rr",className:"stream-wrapper"},this.renderStream(),this.renderConsole()))}}]),t}(r.a.Component)),W=(n(104),n(105),n(111),function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).iconClicked=n.iconClicked.bind(Object(d.a)(n)),n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"iconClicked",value:function(e){var t=this.props.icons[e];this.props.ipc(t.cmd,t.args)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"app-icon-grid"},this.props.icons.map(function(t,n){var a=(n+1)%5,i=Math.floor((n+1)/5),s={gridColumnStart:i,gridColumnEnd:i+1,gridRowStart:a-1,gridRowEnd:a,width:50,height:50,borderColor:"black",borderWidth:2};return r.a.createElement("div",{key:"icon"+n,style:s,onClick:function(){e.iconClicked(n)}},r.a.createElement("i",{className:"fas fa-lg fa-"+t.name}),r.a.createElement("br",null),t.title)}))}}]),t}(r.a.Component)),V=n(44),Y=function(e){return"chrome"==e?H():"public"==e?Q():void 0},X=/\.(gif|jpg|jpeg|tiff|png)$/i,H=function(){var e;function t(){return new Promise(function(t,n){window.requestFileSystem(window.PERSISTENT,1048576,function(n){e=n.root,t(e)})})}function n(n){return new Promise(function(){var a=Object(h.a)(f.a.mark(function a(r,i){return f.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(e){a.next=4;break}return a.next=3,t();case 3:e=a.sent;case 4:e.getFile(n,{create:!1,exclusive:!1},function(e){e.file(function(e){var t=e,n=new FileReader,a="text";n.onloadend=function(e){r({type:a,payload:this.result,file:t})},n.onerror=function(e){i(new Error("reader failed"))},X.test(e.name)?(a="image",n.readAsDataURL(e)):n.readAsText(e)})},function(e){i(e)});case 5:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}())}function a(n,a){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return new Promise(function(){var i=Object(h.a)(f.a.mark(function i(s,o){return f.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(e){i.next=4;break}return i.next=3,t();case 3:e=i.sent;case 4:e.getFile(n,{create:!0,exclusive:!0},function(e){a?e.createWriter(function(t){r&&t.seek(t.length);var n=new Blob([a],{type:"text/plain"});t.write(n),s(e)}):s(e)},o);case 5:case"end":return i.stop()}},i)}));return function(e,t){return i.apply(this,arguments)}}())}function r(e){return new Promise(function(){var n=Object(h.a)(f.a.mark(function n(a,r){return f.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t();case 2:n.sent.getDirectory(e,{create:!1},function(e){e.createReader().readEntries(function(e){a(e)})},r);case 4:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}function i(e){return new Promise(function(){var t=Object(h.a)(f.a.mark(function t(n,a){var i,s,o,c,u;return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:o=[],c=[],(s=[]).push(i={name:e,fullPath:"",id:0}),o.push(i),c[0]=[];case 7:if(!(s.length>0)){t.next=16;break}return(u=s.pop()).id=u.id||0,t.next=12,r(u.name);case 12:t.sent.forEach(function(e){e.id=o.length,o.push(e),c[u.id]=c[u.id]||[],c[u.id].push(e.id),e.isDirectory&&s.push(e)}),t.next=7;break;case 16:n([o,c]);case 17:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}function s(e){alert(e.message)}function o(e,t){return new Promise(function(n,a){e.getFile(t.name,{create:!0,exclusive:!1},function(e){e.createWriter(function(e){e.write(t),n()},s)},s)})}function c(e){return new Promise(function(){var n=Object(h.a)(f.a.mark(function n(a,r){var i,s;return f.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t();case 2:i=n.sent,s=0;case 4:if(!(s<e.length)){n.next=10;break}return n.next=7,o(i,e[s]);case 7:s++,n.next=4;break;case 10:a();case 11:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}return window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.directoryEntry=window.directoryEntry||window.webkitDirectoryEntry,{get_files:function(){var e=Object(h.a)(f.a.mark(function e(t){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i(t);case 3:return e.abrupt("return",e.sent);case 6:e.prev=6,e.t0=e.catch(0),alert(e.t0.message);case 9:case"end":return e.stop()}},e,null,[[0,6]])}));return function(t){return e.apply(this,arguments)}}(),file_put_content:function(){var e=Object(h.a)(f.a.mark(function e(t,n){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a(t,n,!0);case 3:return e.abrupt("return",e.sent);case 6:e.prev=6,e.t0=e.catch(0),alert(e.t0.message);case 9:case"end":return e.stop()}},e,null,[[0,6]])}));return function(t,n){return e.apply(this,arguments)}}(),upload_files:function(){var e=Object(h.a)(f.a.mark(function e(t){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c(t);case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),e.t0;case 8:case"end":return e.stop()}},e,null,[[0,5]])}));return function(t){return e.apply(this,arguments)}}(),file_get_content:function(){var e=Object(h.a)(f.a.mark(function e(t){var a;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n(t);case 3:return a=e.sent,e.abrupt("return",a);case 7:throw e.prev=7,e.t0=e.catch(0),e.t0;case 10:case"end":return e.stop()}},e,null,[[0,7]])}));return function(t){return e.apply(this,arguments)}}()}},G=window.location.hostname,Q=function(){return{get_files:function(e){return new Promise(function(t,n){fetch(G+"/file/azure/list?path="+e).then(function(e){return e.json()}).then(t).catch(function(e){alert(e.message),n(e)})})},file_get_content:function(){var e=Object(h.a)(f.a.mark(function e(t){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),file_put_content:function(){var e=Object(h.a)(f.a.mark(function e(t,n){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),upload_files:function(){var e=Object(h.a)(f.a.mark(function e(t){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}};Y.api_post_json=function(e,t){return new Promise(function(t,n){fetch("http://localhost/api"+e,{method:"POST",headers:{"Content-Type":"application/json"},cache:"no-cache"}).then(function(e){return e.json()}).then(t).catch(n)})};var K=Y,Z=(n(112),function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).componentDidMount=Object(h.a)(f.a.mark(function e(){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n.getFiles();case 1:case"end":return e.stop()}},e)})),n.getFiles=Object(h.a)(f.a.mark(function e(){var t,a,r,i,s;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.state.dirs.join("/"),e.next=3,n.vfs.get_files(t);case 3:if(e.t0=e.sent,e.t0){e.next=6;break}e.t0=[];case 6:i=e.t0,s=Object(V.a)(i,2),a=s[0],r=s[1],n.setState({files:a,edges:r});case 11:case"end":return e.stop()}},e)})),n.add_file=Object(h.a)(f.a.mark(function e(){var t,a,r,i;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=prompt("Enter file name"),a=prompt("Enter file content"),r=n.state.dirs.concat(t),i=r.join("/"),e.next=6,n.vfs.file_put_content(i,a,!0);case 6:n.getFiles();case 7:case"end":return e.stop()}},e)})),n.upload_to_vfs=function(){var e=Object(h.a)(f.a.mark(function e(t){var a;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.target.files.map(function(e){var t=n.state.dirs.push(e.name);return e.name=t.join("/"),e}),e.next=4,n.vfs.upload_files(a);case 4:n.vfs.get_files(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),alert(e.t0.message);case 10:case"end":return e.stop()}},e,null,[[0,7]])}));return function(t){return e.apply(this,arguments)}}(),n.prompt_array=function(e){var t=[];return e.forEach(function(e,n){t.push(prompt("question: "+e))}),t},n.renderPreview=function(){var e=n.state.previewFile;return e?r.a.createElement("table",{style:{position:"absolute",left:"55%",top:0,height:"70%",width:"40%",backgroundColor:"transparent"}},r.a.createElement("tr",null,r.a.createElement("td",{colspan:4},n.renderPreviewContent())),r.a.createElement("tr",null,r.a.createElement("td",{colspan:4},r.a.createElement("p",null,"Size: ",e.size),r.a.createElement("p",null,"Type: ",e.type))),r.a.createElement("tr",null,r.a.createElement("td",{colspan:2},r.a.createElement("button",{class:"btn btn-primary",onClick:function(e){var t=n.prompt_array(["category","price"]);K.api_post_json("/files/publish",t).then(function(e){var t=e.responseText||JSON.stringify(e);alert(t)}).catch(function(e){alert(e.message)})}}," Publish ")),r.a.createElement("td",{colspan:2},r.a.createElement("button",{class:"btn btn-primary"},"Share")))):null},n.renderPreviewContent=function(){return null!==n.state.previewURL?r.a.createElement("img",{height:"50%",width:"100%",src:n.state.previewURL}):null!==n.state.previewText?r.a.createElement("div",{height:"50%",widht:"100%"},n.state.previewText):void 0},n.renderFileInfo=function(e){return e?r.a.createElement("table",null,r.a.createElement("tr",null,r.a.createElement("td",{colspan:4},r.a.createElement("p",null,"Size: ",e.size),r.a.createElement("p",null,"Type: ",e.type)))):""},n.clickedFile=function(){var e=Object(h.a)(f.a.mark(function e(t){var a;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.vfs.file_get_content(t.fullPath);case 3:"text"===(a=e.sent).type?n.setState({previewURL:null,previewText:a.payload,previewFile:a.file}):"image"===a.type&&n.setState({previewText:null,previewURL:a.payload,previewFile:a.file}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),alert(e.t0.message);case 10:case"end":return e.stop()}},e,null,[[0,7]])}));return function(t){return e.apply(this,arguments)}}(),n.clickedDir=function(){var e=Object(h.a)(f.a.mark(function e(t){var a;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=n.state.dirs.concat(t),n.setState({dirs:a,current_node_id:t.id});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.backDir=function(e){if(0!==e){var t,a=[];for(t in n.state.dirs)if(a.push(n.state.dirs[t]),e==n.state.dirs[t].id)break;n.setState({dirs:a,current_node_id:e})}else n.setState({dirs:[],current_node_id:0})},n.renderBreadCrumb=function(){return r.a.createElement("span",{style:{position:"absolute",top:0,left:0,height:"20px",width:"100%"}},r.a.createElement("a",{onClick:function(){n.backDir(0)}},n.state.fs_type+" >"),n.state.dirs.map(function(e){return r.a.createElement("a",{onClick:function(){n.backDir(e.id)}},e.name+" >")}))},n.renderBody2=function(){var e=[],t=n.state.edges[n.state.current_node_id]||[],a=n.state.files||[];if(t.forEach(function(t){e.push(a[t])}),0==e.length)return r.a.createElement("div",null,"No Files");return r.a.createElement("div",{className:"anchor",style:{position:"relative"}},r.a.createElement("div",{className:"file_list",style:{position:"absolute",top:"20px",height:"calc(100% - 60px)",left:0,width:"47%",overflow:"scroll",paddingLeft:"2%",backgroundColor:"#2A2A2A"}},e.map(function(e,t){var a={marginLeft:"20px",width:"calc(100% - 40px)",color:"#D7D7D7",backgroundColor:t%2===0?"#2A2A2A":"#242424",height:"20px"};return r.a.createElement("div",{style:a,onClick:function(){e.isDirectory?n.clickedDir(e):n.clickedFile(e)}},r.a.createElement("span",null,e.name),r.a.createElement("span",{style:{float:"right"}},e.isDirectory?"dir":"file"))})),r.a.createElement("div",{className:"Controls",style:{position:"absolute",bottom:"0px",height:"40px",width:"100%",left:0,float:"right"}},r.a.createElement("button",{className:"btn",onClick:n.add_file},"Compose"),"\xa0","\xa0",r.a.createElement("button",{className:"btn",onClick:n.upload_to_vfs},"Upload")))},n.state={info:"finder",dirs:e.dirs||[],current_node_id:e.current_node_id||0,fs_type:e.fs_type||"chrome",files:e.files||[],edges:e.edges||[],previewURL:null,previewText:null,previewFile:null},n.vfs=K(e.fs_type),n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement(w,{icon:"computer",title:"My Computer",windowInfo:this.state.xpath},r.a.createElement("div",{className:"anchor"},this.renderBreadCrumb(),this.renderBody2(),this.renderPreview()))}}]),t}(r.a.Component)),$=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={processes:[{name:"tty",state:"on"}],userInfo:{name:"guest",xp:0,gold:0},quests:[],icons:[{name:"folder",title:"Local Files",cmd:"finder",args:["chrome"]},{name:"folder",title:"Public Files",cmd:"finder",args:["public"]},{name:"folder",title:"Google Drive",cmd:"finder",args:["google"]},{name:"folder",title:"Dropbox Files",cmd:"finder",args:["dropbox"]},{name:"folder",title:"Facebook Files",cmd:"finder",args:["fb"]},{name:"terminal",title:"terminal",cmd:"tty",args:[]},{name:"broadcast-tower",title:"Broadcast",cmd:"stream",args:[]},{name:"play-circle",title:"Watch Hearthstone",cmd:"watch",args:["rank_5_rogue"]},{name:"editor",title:"Word(sic)"}]},n.ipc=n.ipc.bind(Object(d.a)(n)),n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){if(window.location.search){var e=window.location.search.replace("?","").split("/"),t=e[0],n=e.splice(1);this.ipc(t,n)}}},{key:"ipc",value:function(e,t){switch(console.log("desktop ipc ",e,t),e){case"close":var n=t[0],a=this.state.processes;a[n]="closed",this.setState({processes:a});break;case"edit":var r=this.state.processes.concat({name:"iframe",url:"/api/files/edit?url="+t[0]+"&context="+t[1]});this.setState({processes:r});break;case"cam":case"camera":case"broadcast":case"stream":case"watch":case"tty":case"compose":case"finder":r=this.state.processes.concat({name:e,args:t});this.setState({processes:r});break;case"hud-update":this.setState({userInfo:t});break;case"questlist":this.setState({quests:t})}}},{key:"renderBody",value:function(){var e=this;return this.state.processes.map(function(t,n){if(console.log(t,n),"off"===t.state)return null;if("tty"===t.name)return r.a.createElement(C,{key:"tty1",pid:n,title:"tty",ipc:e.ipc});if("camera"===t.name)return r.a.createElement(T,{userInfo:e.state.userInfo,pid:n,title:"Face 2 Face",ipc:e.ipc});if("stream"===t.name)return r.a.createElement(F,{args:t.args,channel:t.args[0]||"",pid:n,title:"Broadcast",ipc:e.ipc});if("watch"===t.name){var a=t.args[0]||"default";return r.a.createElement(q,{userInfo:e.state.userInfo,channelName:a,pid:n,title:"Watch",ipc:e.ipc})}if("iframe"===t.name)return r.a.createElement("iframe",{width:"90%",height:"80%",src:t.url});if("finder"===t.name){var i=t.args[0]||"";return r.a.createElement(Z,{ipc:e.ipc,title:"Finder",fs_type:i})}})}},{key:"renderHud",value:function(){return this.state.userInfo?r.a.createElement(S,{username:this.state.userInfo.username,cwd:this.state.userInfo.cwd,fname:this.state.userInfo.fname,xp:this.state.userInfo.xp,gold:this.state.userInfo.gold}):null}},{key:"renderQuestView",value:function(){return r.a.createElement(y,{className:"quest-list",title:"quests",list:this.state.quests})}},{key:"renderBackground",value:function(){return r.a.createElement(W,{icons:this.state.icons,ipc:this.ipc})}},{key:"render",value:function(){return r.a.createElement("div",{className:"desktop"},r.a.createElement("nav",{style:{width:"100vw",height:"18px"},className:"navbar navbar-light bg-light"},r.a.createElement("a",{className:"navbar-brand",href:"#"},"GrepAwk"),this.renderHud()),r.a.createElement("div",{style:{top:"18px",position:"absolute",width:"100vw",height:"calc(100% - 18px)"}},this.renderBackground(),this.renderBody(),this.renderQuestView()))}}]),t}(r.a.Component);s.a.render(r.a.createElement($,null),document.getElementById("root"))},45:function(e,t,n){e.exports=n(113)},50:function(e,t,n){},51:function(e,t,n){},53:function(e,t,n){},54:function(e,t,n){},93:function(e,t){}},[[45,1,2]]]);
//# sourceMappingURL=main.f98a9474.chunk.js.map